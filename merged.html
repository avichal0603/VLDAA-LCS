<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Programming Learning Suite</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Global Styles & Variables */
        :root {
            /* Color Variables */
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent-primary: #0ea5e9;
            --accent-light: #e0f2fe;
            --bg-primary: #f8fafc;
            --bg-card: #ffffff;
            --border-color: #e2e8f0;
            --correct-color: #10b981;
            --incorrect-color: #ef4444;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            
            /* Main Visualizer Variables */
            --bg: #020617;
            --bg-elevated: #020617;
            --bg-panel: #020617;
            --bg-panel-soft: #020617;
            --accent: #38bdf8;
            --accent-soft: rgba(56, 189, 248, 0.08);
            --accent-soft-strong: rgba(56, 189, 248, 0.16);
            --border-subtle: rgba(148, 163, 184, 0.28);
            --border-strong: rgba(148, 163, 184, 0.6);
            --text-main: #e5e7eb;
            --text-muted: #9ca3af;
            --danger: #f97373;
            --match: #22c55e;
            --trace: #fbbf24;
            --highlight: #fbbf24;
            --secondary: #fbbf24;
            --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            --radius-lg: 14px;
            --radius-md: 10px;
            --radius-sm: 6px;
            --shadow-soft: 0 20px 40px rgba(15, 23, 42, 0.75);
            --transition-fast: 0.15s ease;
            --transition-med: 0.2s ease;
            --transition-slow: 0.3s ease;
            --glow-accent: 0 0 20px rgba(56, 189, 248, 0.4);
            --glow-match: 0 0 20px rgba(34, 197, 94, 0.4);
            --glow-trace: 0 0 20px rgba(251, 191, 36, 0.4);
            --glow-highlight: 0 0 20px rgba(251, 191, 36, 0.6);
        }

        [data-theme="light"] {
            --bg: #f8fafc;
            --bg-elevated: #ffffff;
            --bg-panel: #ffffff;
            --bg-panel-soft: #f8fafc;
            --accent: #3b82f6;
            --accent-soft: rgba(59, 130, 246, 0.08);
            --accent-soft-strong: rgba(59, 130, 246, 0.12);
            --border-subtle: rgba(148, 163, 184, 0.16);
            --border-strong: rgba(148, 163, 184, 0.3);
            --text-main: #1e293b;
            --text-muted: #64748b;
            --danger: #ef4444;
            --match: #10b981;
            --trace: #3b82f6;
            --highlight: #3b82f6;
            --secondary: #3b82f6;
            --glow-accent: 0 0 15px rgba(59, 130, 246, 0.3);
            --glow-match: 0 0 15px rgba(16, 185, 129, 0.3);
            --glow-trace: 0 0 15px rgba(59, 130, 246, 0.3);
            --glow-highlight: 0 0 15px rgba(59, 130, 246, 0.4);
            
            /* Test page overrides for light theme */
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent-primary: #0ea5e9;
            --accent-light: #e0f2fe;
            --bg-primary: #f8fafc;
            --bg-card: #ffffff;
            --border-color: #e2e8f0;
        }

        /* Global Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            transition: background-color var(--transition-slow), color var(--transition-slow);
        }

        /* Navigation */
        .mode-navigation {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            background: var(--bg-card);
            padding: 10px 15px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }

        .mode-btn {
            padding: 8px 16px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mode-btn:hover {
            background: var(--accent-light);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .mode-btn.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        /* Main Container */
        .main-container {
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        /* Page Sections */
        .page-section {
            display: none;
            height: 100%;
            width: 100%;
        }

        .page-section.active {
            display: block;
        }

        /* Test Pages Common Styles */
        .test-header {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 20px 40px;
            border-bottom: 3px solid var(--accent-primary);
            flex-shrink: 0;
        }

        .test-header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .test-header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .test-icon {
            font-size: 2.5rem;
            color: var(--accent-primary);
        }

        .header-text h1 {
            font-size: 1.8rem;
            background: linear-gradient(90deg, var(--text-primary), var(--accent-primary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 5px;
        }

        .header-text p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .progress-container {
            background-color: white;
            padding: 15px 25px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            min-width: 300px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .progress-bar {
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), #3b82f6);
            border-radius: 4px;
            width: 10%;
            transition: width 0.5s ease;
        }

        .test-main-container {
            display: flex;
            flex: 1;
            padding: 20px;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            height: calc(100vh - 140px);
            overflow: hidden;
        }

        .question-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: 30px;
            min-width: 0;
            overflow: hidden;
        }

        .question-header {
            margin-bottom: 25px;
        }

        .question-number {
            display: inline-block;
            background-color: var(--accent-light);
            color: var(--accent-primary);
            font-weight: 700;
            padding: 8px 20px;
            border-radius: 20px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .question-text {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.5;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
        }

        .option {
            padding: 18px 20px;
            background-color: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            font-weight: 500;
        }

        .option:hover {
            background-color: var(--accent-light);
            border-color: var(--accent-primary);
            transform: translateX(5px);
        }

        .option.selected {
            background-color: var(--accent-light);
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
        }

        .option.correct {
            background-color: rgba(16, 185, 129, 0.1);
            border-color: var(--correct-color);
        }

        .option.incorrect {
            background-color: rgba(239, 68, 68, 0.1);
            border-color: var(--incorrect-color);
        }

        .option-letter {
            display: inline-block;
            width: 36px;
            height: 36px;
            background-color: var(--border-color);
            color: var(--text-primary);
            border-radius: 50%;
            text-align: center;
            line-height: 36px;
            font-weight: 700;
            margin-right: 15px;
            flex-shrink: 0;
            transition: background-color 0.2s ease;
        }

        .option:hover .option-letter {
            background-color: var(--accent-primary);
            color: white;
        }

        .option.selected .option-letter {
            background-color: var(--accent-primary);
            color: white;
        }

        .option.correct .option-letter {
            background-color: var(--correct-color);
            color: white;
        }

        .option.incorrect .option-letter {
            background-color: var(--incorrect-color);
            color: white;
        }

        .visualization-panel {
            flex: 1;
            background-color: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: 30px;
            display: flex;
            flex-direction: column;
            min-width: 0;
            overflow: hidden;
        }

        .visualization-header {
            margin-bottom: 25px;
        }

        .visual-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .visual-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .visual-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .visual-content h3 {
            color: var(--text-primary);
            margin: 15px 0 10px 0;
        }

        .highlight {
            background-color: var(--accent-light);
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            font-weight: 600;
            color: var(--accent-primary);
        }

        .default-visualization {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-secondary);
            text-align: center;
        }

        .default-visualization i {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .dp-table {
            margin: 15px 0;
            border-collapse: collapse;
            width: 100%;
            max-width: 400px;
        }

        .dp-table td, .dp-table th {
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: center;
            font-family: monospace;
        }

        .dp-table th {
            background-color: var(--accent-light);
            font-weight: 600;
        }

        .match-cell {
            background-color: rgba(16, 185, 129, 0.2);
        }

        .feedback-area {
            margin-top: 20px;
            padding: 15px;
            border-radius: var(--radius-md);
            display: none;
        }

        .feedback-area.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .feedback-area.correct {
            background-color: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .feedback-area.incorrect {
            background-color: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .feedback-text {
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feedback-text.correct {
            color: var(--correct-color);
        }

        .feedback-text.incorrect {
            color: var(--incorrect-color);
        }

        .feedback-explanation {
            font-size: 0.95rem;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--accent-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #0284c7;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background-color: white;
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: var(--bg-primary);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .results-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .results-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .results-card {
            background-color: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 50px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            box-shadow: var(--shadow-lg);
        }

        .results-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--accent-primary);
        }

        .score-display {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--accent-primary), #3b82f6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin: 20px 0;
        }

        /* Post-test specific colors */
        .posttest .test-header {
            border-bottom: 3px solid #10b981;
        }

        .posttest .test-icon {
            color: #10b981;
        }

        .posttest .question-number {
            background-color: #d1fae5;
            color: #10b981;
        }

        .posttest .progress-fill {
            background: linear-gradient(90deg, #10b981, var(--accent-primary));
        }

        .posttest .btn-primary {
            background-color: #10b981;
        }

        .posttest .btn-primary:hover {
            background-color: #059669;
        }

        .posttest .results-icon {
            color: #10b981;
        }

        .posttest .score-display {
            background: linear-gradient(90deg, #10b981, var(--accent-primary));
        }

        /* Main Visualizer Styles */
        .app-shell {
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle at 10% 0%, #020617, #000 60%);
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
            overflow: hidden;
            transition: background var(--transition-slow);
        }

        [data-theme="light"] .app-shell {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }

        .app-shell::before {
            content: "";
            position: absolute;
            inset: -120px;
            background:
                radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.06), transparent 60%),
                radial-gradient(circle at 100% 100%, rgba(251, 191, 36, 0.06), transparent 60%);
            opacity: 0.9;
            pointer-events: none;
            z-index: 0;
            transition: all var(--transition-slow);
        }

        [data-theme="light"] .app-shell::before {
            background:
                radial-gradient(circle at 0% 0%, rgba(14, 165, 233, 0.05), transparent 60%),
                radial-gradient(circle at 100% 100%, rgba(59, 130, 246, 0.05), transparent 60%);
            opacity: 0.6;
        }

        .app-content {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
            height: 100%;
            overflow: hidden;
        }

        header.app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            padding: 0 4px;
            flex-shrink: 0;
        }

        .title-block {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .title-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .app-title {
            font-size: 19px;
            font-weight: 600;
            letter-spacing: 0.03em;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, var(--highlight), #fde68a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
        }

        .app-title i {
            font-size: 18px;
            background: linear-gradient(135deg, var(--highlight), #fde68a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.3);
            transition: transform var(--transition-fast);
        }

        .app-title:hover i {
            transform: rotate(15deg);
        }

        .title-text {
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.3);
        }

        [data-theme="light"] .app-title {
            background: linear-gradient(135deg, var(--highlight), #93c5fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        [data-theme="light"] .app-title i {
            background: linear-gradient(135deg, var(--highlight), #93c5fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
        }

        [data-theme="light"] .title-text {
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
        }

        .app-title-pill {
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            padding: 2px 7px;
            border-radius: 999px;
            border: 1px solid rgba(251, 191, 36, 0.3);
            background: rgba(251, 191, 36, 0.1);
            color: var(--highlight);
            transition: all var(--transition-med);
            box-shadow: 0 0 8px rgba(251, 191, 36, 0.2);
        }

        .app-title-pill:hover {
            border-color: var(--highlight);
            background: rgba(251, 191, 36, 0.15);
            box-shadow: 0 0 12px rgba(251, 191, 36, 0.3);
        }

        [data-theme="light"] .app-title-pill {
            border: 1px solid rgba(59, 130, 246, 0.3);
            background: rgba(59, 130, 246, 0.1);
            color: var(--highlight);
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.2);
        }

        [data-theme="light"] .app-title-pill:hover {
            border-color: var(--highlight);
            background: rgba(59, 130, 246, 0.15);
            box-shadow: 0 0 12px rgba(59, 130, 246, 0.3);
        }

        .title-sub {
            font-size: 11px;
            color: var(--text-muted);
        }

        .header-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .badge-soft {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            background: var(--accent-soft);
            color: var(--text-muted);
            transition: all var(--transition-med);
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            user-select: none;
        }

        .badge-soft:hover {
            border-color: var(--accent);
            background: var(--accent-soft-strong);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(56, 189, 248, 0.2);
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            background: var(--accent-soft);
            transition: all var(--transition-med);
        }

        .theme-toggle:hover {
            border-color: var(--accent);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(56, 189, 248, 0.2);
        }

        .theme-toggle-icon {
            font-size: 12px;
            color: var(--text-muted);
            transition: transform var(--transition-fast);
        }

        .theme-toggle:hover .theme-toggle-icon {
            transform: rotate(30deg);
        }

        .theme-toggle-text {
            font-size: 10px;
            color: var(--text-muted);
        }

        .layout {
            display: grid;
            grid-template-columns: 360px 1fr;
            gap: 10px;
            flex: 1;
            overflow: hidden;
            min-height: 0;
        }

        .panel {
            border-radius: var(--radius-lg);
            background: var(--bg-panel);
            border: 1px solid var(--border-subtle);
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 0;
            overflow: hidden;
            box-shadow: var(--shadow-soft);
            transition: all var(--transition-med);
            position: relative;
        }

        [data-theme="light"] .panel {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        }

        .panel::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            opacity: 0;
            transition: opacity var(--transition-med);
        }

        .panel:hover::after {
            opacity: 0.6;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 6px;
            flex-shrink: 0;
        }

        .panel-title {
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .panel-subtitle {
            font-size: 10px;
            color: var(--text-muted);
        }

        .algorithm-selector {
            display: flex;
            gap: 4px;
            background: var(--bg-panel-soft);
            border-radius: var(--radius-md);
            padding: 2px;
            border: 1px solid var(--border-subtle);
            margin-top: 4px;
        }

        .algo-tab {
            flex: 1;
            padding: 5px 8px;
            text-align: center;
            font-size: 9px;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .algo-tab:hover {
            background: rgba(251, 191, 36, 0.1);
            color: var(--highlight);
            border-color: rgba(251, 191, 36, 0.3);
        }

        .algo-tab.active {
            background: rgba(251, 191, 36, 0.15);
            color: var(--highlight);
            border-color: rgba(251, 191, 36, 0.5);
            box-shadow: 0 0 0 1px rgba(251, 191, 36, 0.2);
        }

        [data-theme="light"] .algo-tab:hover {
            background: rgba(59, 130, 246, 0.1);
            color: var(--highlight);
            border-color: rgba(59, 130, 246, 0.3);
        }

        [data-theme="light"] .algo-tab.active {
            background: rgba(59, 130, 246, 0.15);
            color: var(--highlight);
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.2);
        }

        .algo-info {
            font-size: 9px;
            color: var(--text-muted);
            padding: 4px 6px;
            border-radius: var(--radius-sm);
            background: var(--bg-panel-soft);
            margin-top: 2px;
            border-left: 2px solid var(--highlight);
            transition: all var(--transition-med);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .inputs-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-shrink: 0;
        }

        .input-row {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        label {
            font-size: 10px;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
            gap: 4px;
            align-items: baseline;
        }

        label span.key {
            font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas,
                "Liberation Mono", "Courier New", monospace;
            font-size: 10px;
            color: var(--accent);
        }

        input[type="text"] {
            border-radius: var(--radius-md);
            border: 1px solid var(--border-subtle);
            background: var(--bg-panel-soft);
            color: var(--text-main);
            padding: 6px 8px;
            font-size: 12px;
            outline: none;
            width: 100%;
            transition: all var(--transition-fast);
        }

        input[type="text"]:focus {
            border-color: var(--highlight);
            box-shadow: 0 0 0 1px rgba(251, 191, 36, 0.3), var(--glow-highlight);
            background: var(--bg-elevated);
            transform: translateY(-0.5px);
        }

        [data-theme="light"] input[type="text"]:focus {
            border-color: var(--highlight);
            box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.3), var(--glow-highlight);
        }

        .hint-text {
            font-size: 9px;
            color: var(--text-muted);
            margin-top: 1px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .preset-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 2px;
        }

        .chip {
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            padding: 2px 7px;
            font-size: 9px;
            color: var(--text-muted);
            cursor: pointer;
            background: var(--bg-panel-soft);
            transition: all var(--transition-fast);
            user-select: none;
            display: inline-flex;
            align-items: center;
            gap: 3px;
        }

        .chip:hover {
            background: rgba(56, 189, 248, 0.1);
            border-color: var(--accent);
            color: var(--accent);
            transform: translateY(-0.5px);
            box-shadow: 0 4px 8px rgba(56, 189, 248, 0.1);
        }

        [data-theme="light"] .chip:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--accent);
            color: var(--accent);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.1);
        }

        .controls-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
        }

        button {
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            background: var(--bg-panel-soft);
            color: var(--text-main);
            font-size: 10px;
            padding: 5px 10px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: all var(--transition-fast);
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        button:hover::before {
            left: 100%;
        }

        button.primary {
            border-color: var(--highlight);
            background: rgba(251, 191, 36, 0.15);
        }

        [data-theme="light"] button.primary {
            border-color: var(--highlight);
            background: rgba(59, 130, 246, 0.15);
        }

        button:hover {
            transform: translateY(-0.5px);
            border-color: var(--highlight);
            color: var(--highlight);
            background: rgba(251, 191, 36, 0.2);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.2);
        }

        [data-theme="light"] button:hover {
            border-color: var(--highlight);
            color: var(--highlight);
            background: rgba(59, 130, 246, 0.2);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.4;
            cursor: default;
            transform: none;
            box-shadow: none;
        }

        button:disabled::before {
            display: none;
        }

        .controls-row .spacer {
            flex: 1;
        }

        .icon-dot {
            width: 6px;
            height: 6px;
            border-radius: 999px;
            background: var(--highlight);
            box-shadow: 0 0 11px rgba(251, 191, 36, 0.9);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.7; box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7); }
            50% { opacity: 1; box-shadow: 0 0 0 6px rgba(251, 191, 36, 0); }
            100% { opacity: 0.7; box-shadow: 0 0 0 0 rgba(251, 191, 36, 0); }
        }

        [data-theme="light"] .icon-dot {
            background: var(--highlight);
            box-shadow: 0 0 11px rgba(59, 130, 246, 0.7);
            animation: pulse-light 2s infinite;
        }

        @keyframes pulse-light {
            0% { opacity: 0.7; box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            50% { opacity: 1; box-shadow: 0 0 0 6px rgba(59, 130, 246, 0); }
            100% { opacity: 0.7; box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }

        .premium-slider {
            --slider-height: 4px;
            --thumb-size: 16px;
            margin-top: 2px;
        }

        .slider-container {
            flex: 1;
            position: relative;
            padding: 10px 0;
            height: 20px;
        }

        .premium-slider-track {
            width: 100%;
            height: var(--slider-height);
            background: rgba(148, 163, 184, 0.1);
            backdrop-filter: blur(4px);
            border-radius: var(--radius-sm);
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 
                inset 0 1px 1px rgba(0, 0, 0, 0.1),
                0 2px 4px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .premium-slider-fill {
            height: 100%;
            background: linear-gradient(90deg, 
                rgba(56, 189, 248, 0.8), 
                rgba(167, 139, 250, 0.8));
            border-radius: var(--radius-sm);
            width: 0%;
            transition: width 0.1s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 0 10px rgba(56, 189, 248, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .premium-slider-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.15), 
                transparent);
            animation: sliderShimmer 3s infinite linear;
        }

        @keyframes sliderShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .premium-slider-input {
            width: 100%;
            height: 20px;
            margin: 0;
            opacity: 0;
            cursor: pointer;
            position: relative;
            z-index: 2;
        }

        .premium-slider-thumb {
            width: var(--thumb-size);
            height: var(--thumb-size);
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 0%;
            transform: translate(-50%, -50%);
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.2),
                0 0 0 2px rgba(56, 189, 248, 0.3),
                0 0 15px rgba(56, 189, 248, 0.5);
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1;
            pointer-events: none;
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .premium-slider-thumb:hover {
            transform: translate(-50%, -50%) scale(1.15);
            box-shadow: 
                0 3px 12px rgba(0, 0, 0, 0.25),
                0 0 0 3px rgba(56, 189, 248, 0.4),
                0 0 20px rgba(56, 189, 248, 0.7);
        }

        .premium-slider-thumb.active {
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 
                0 0 0 3px rgba(56, 189, 248, 0.6),
                0 0 25px rgba(56, 189, 248, 0.9);
        }

        .premium-slider-marks {
            display: flex;
            justify-content: space-between;
            margin-top: 4px;
            font-size: 8px;
            color: var(--text-muted);
        }

        .slider-mark {
            position: relative;
            cursor: pointer;
            padding: 1px 3px;
            border-radius: 3px;
            transition: all 0.2s ease;
            opacity: 0.7;
        }

        .slider-mark:hover {
            color: var(--accent);
            background: var(--accent-soft);
            opacity: 1;
        }

        .slider-mark.active {
            color: var(--accent);
            font-weight: 600;
            opacity: 1;
            background: var(--accent-soft);
        }

        .slider-value {
            font-size: 9px;
            color: var(--accent);
            font-weight: 500;
            min-width: 50px;
            text-align: right;
            font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas,
                "Liberation Mono", "Courier New", monospace;
        }

        @keyframes thumbPulse {
            0% { 
                box-shadow: 
                    0 2px 8px rgba(0, 0, 0, 0.2),
                    0 0 0 2px rgba(56, 189, 248, 0.3),
                    0 0 15px rgba(56, 189, 248, 0.5);
            }
            50% { 
                box-shadow: 
                    0 3px 10px rgba(0, 0, 0, 0.25),
                    0 0 0 3px rgba(56, 189, 248, 0.6),
                    0 0 20px rgba(56, 189, 248, 0.8);
            }
            100% { 
                box-shadow: 
                    0 2px 8px rgba(0, 0, 0, 0.2),
                    0 0 0 2px rgba(56, 189, 248, 0.3),
                    0 0 15px rgba(56, 189, 248, 0.5);
            }
        }

        [data-theme="light"] .premium-slider-track {
            background: rgba(148, 163, 184, 0.08);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        [data-theme="light"] .premium-slider-fill {
            background: linear-gradient(90deg, 
                rgba(14, 165, 233, 0.8), 
                rgba(139, 92, 246, 0.8));
            box-shadow: 
                0 0 8px rgba(14, 165, 233, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        [data-theme="light"] .premium-slider-thumb {
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.15),
                0 0 0 2px rgba(14, 165, 233, 0.25),
                0 0 10px rgba(14, 165, 233, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.9);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 6px;
            margin-top: 4px;
        }

        .stat-card {
            border-radius: var(--radius-md);
            padding: 6px 7px;
            border: 1px solid var(--border-subtle);
            background: var(--bg-panel-soft);
            display: flex;
            flex-direction: column;
            gap: 2px;
            transition: all var(--transition-med);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-1px);
            border-color: var(--accent);
            box-shadow: 0 4px 12px rgba(56, 189, 248, 0.1);
        }

        .stat-label {
            font-size: 9px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-value {
            font-size: 11px;
            font-weight: 500;
        }

        .stat-badge {
            font-size: 9px;
            color: var(--accent);
        }

        .explanation-box {
            margin-top: 4px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-subtle);
            background: var(--bg-panel-soft);
            padding: 6px 7px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex: 1;
            min-height: 0;
            overflow-y: auto;
        }

        .explanation-box:hover {
            border-color: var(--accent);
            box-shadow: 0 4px 12px rgba(56, 189, 248, 0.1);
        }

        .explanation-title {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.12em;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .explanation-title span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        #explanation-text {
            font-size: 11px;
            color: var(--text-main);
            line-height: 1.4;
            flex: 1;
            overflow-y: auto;
        }

        .lcs-output-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            gap: 6px;
            margin-top: 2px;
            font-size: 10px;
            color: var(--text-muted);
            flex-shrink: 0;
        }

        .lcs-output-row div {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        #lcs-string {
            font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas,
                "Liberation Mono", "Courier New", monospace;
            font-size: 11px;
            color: var(--highlight);
            word-break: break-all;
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            background: rgba(251, 191, 36, 0.1);
            transition: all var(--transition-fast);
            border: 1px solid rgba(251, 191, 36, 0.2);
        }

        #lcs-string:hover {
            box-shadow: var(--glow-highlight);
            border-color: rgba(251, 191, 36, 0.4);
        }

        [data-theme="light"] #lcs-string {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        [data-theme="light"] #lcs-string:hover {
            box-shadow: var(--glow-highlight);
            border-color: rgba(59, 130, 246, 0.4);
        }

        .pill {
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            padding: 2px 6px;
            font-size: 9px;
            color: var(--text-muted);
        }

        .right-panel-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }

        .visual-comparison {
            border-radius: var(--radius-md);
            padding: 8px 10px;
            border: 1px solid var(--border-subtle);
            background: var(--bg-panel-soft);
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex-shrink: 0;
            transition: all var(--transition-med);
        }

        .visual-comparison:hover {
            border-color: var(--accent);
            box-shadow: 0 4px 12px rgba(56, 189, 248, 0.1);
        }

        .comparison-title {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.12em;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .comparison-title span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .comparison-strings {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .string-display {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .string-label {
            font-size: 9px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .string-label span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .string-chars {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
        }

        .char-box {
            min-width: 26px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            border: 1px solid var(--border-subtle);
            background: var(--bg-panel-soft);
            font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas,
                "Liberation Mono", "Courier New", monospace;
            font-size: 12px;
            position: relative;
            transition: all var(--transition-med);
        }

        .char-box:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .char-box-index {
            position: absolute;
            top: -2px;
            right: -2px;
            font-size: 7px;
            background: var(--bg-panel);
            border: 1px solid var(--border-subtle);
            border-radius: 999px;
            padding: 0px 3px;
            color: var(--text-muted);
        }

        .char-box-current-a {
            border-color: var(--accent);
            background: var(--accent-soft-strong);
            transform: translateY(-2px);
            animation: pulse-accent 1.5s infinite;
        }

        .char-box-current-b {
            border-color: var(--secondary);
            background: rgba(167, 139, 250, 0.16);
            transform: translateY(-2px);
            animation: pulse-secondary 1.5s infinite;
        }

        .char-box-match {
            border-color: var(--match);
            background: rgba(34, 197, 94, 0.14);
            animation: pulse-match 2s infinite;
        }

        .char-box-in-lcs {
            border-color: var(--trace);
            background: rgba(251, 191, 36, 0.15);
            animation: pulse-trace 2s infinite;
        }

        [data-theme="light"] .char-box-in-lcs {
            border-color: var(--trace);
            background: rgba(59, 130, 246, 0.15);
            animation: pulse-trace-light 2s infinite;
        }

        @keyframes pulse-accent {
            0% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(56, 189, 248, 0); }
            100% { box-shadow: 0 0 0 0 rgba(56, 189, 248, 0); }
        }

        @keyframes pulse-secondary {
            0% { box-shadow: 0 0 0 0 rgba(167, 139, 250, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(167, 139, 250, 0); }
            100% { box-shadow: 0 0 0 0 rgba(167, 139, 250, 0); }
        }

        @keyframes pulse-match {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }

        @keyframes pulse-trace {
            0% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(251, 191, 36, 0); }
            100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0); }
        }

        @keyframes pulse-trace-light {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }

        .comparison-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: var(--accent);
            opacity: 0;
            transition: opacity var(--transition-med);
            min-height: 18px;
            font-weight: 500;
            gap: 6px;
        }

        .comparison-arrow.visible {
            opacity: 1;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dp-wrapper {
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-subtle);
            background: var(--bg-panel);
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }

        .dp-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 10px;
            color: var(--text-muted);
            flex-shrink: 0;
            gap: 8px;
        }

        #dp-table-title {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .dp-visualization-area {
            display: flex;
            flex-direction: row;
            gap: 12px;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }

        .dp-table-section {
            flex: 2;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .dp-table-container {
            border-radius: var(--radius-md);
            border: 1px solid var(--border-subtle);
            background: var(--bg-panel-soft);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
            transition: all var(--transition-med);
        }

        .dp-table-container:hover {
            border-color: var(--accent);
            box-shadow: 0 4px 20px rgba(56, 189, 248, 0.15);
        }

        .dp-table-scroll {
            overflow: auto;
            padding: 5px;
            scrollbar-width: thin;
            scrollbar-color: var(--border-subtle) transparent;
            height: 100%;
            flex: 1;
        }

        .dp-table-scroll::-webkit-scrollbar {
            height: 5px;
            width: 5px;
        }

        .dp-table-scroll::-webkit-scrollbar-thumb {
            background: var(--border-subtle);
            border-radius: 999px;
        }

        .legend-row {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            font-size: 9px;
            margin-top: 4px;
        }

        .legend-chip {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 2px 5px;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            background: var(--bg-panel-soft);
            transition: all var(--transition-fast);
        }

        .legend-chip:hover {
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .legend-color {
            width: 8px;
            height: 8px;
            border-radius: 2px;
            transition: all var(--transition-fast);
        }

        .legend-color.match {
            background: var(--match);
            opacity: 0.7;
        }

        .legend-chip:hover .legend-color.match {
            animation: pulse-match 1s infinite;
        }

        .legend-color.current {
            background: var(--accent);
        }

        .legend-chip:hover .legend-color.current {
            animation: pulse-accent 1s infinite;
        }

        .legend-color.trace {
            background: var(--trace);
        }

        .legend-chip:hover .legend-color.trace {
            animation: pulse-trace 1s infinite;
        }

        .legend-color.base {
            background: var(--text-muted);
        }

        table.dp-table {
            border-collapse: separate;
            border-spacing: 0;
            font-size: 10px;
            min-width: max-content;
        }

        .dp-table th,
        .dp-table td {
            border: 1px solid var(--border-subtle);
            padding: 3px 4px;
            text-align: center;
            min-width: 28px;
            max-width: 36px;
            transition: all var(--transition-med);
        }

        .dp-table th {
            background: var(--bg-panel);
            position: sticky;
            top: 0;
            z-index: 2;
        }

        .dp-table th.corner {
            left: 0;
            z-index: 3;
        }

        .dp-table td.header-col {
            position: sticky;
            left: 0;
            background: var(--bg-panel);
            z-index: 1;
            font-weight: 500;
        }

        .header-cell {
            font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas,
                "Liberation Mono", "Courier New", monospace;
            font-size: 10px;
            color: var(--accent);
        }

        .dp-cell {
            background: var(--bg-panel-soft);
            color: var(--text-main);
            transition: all var(--transition-med);
        }

        .dp-cell-base {
            background: var(--bg-panel);
            color: var(--text-muted);
        }

        .dp-cell-match {
            background: rgba(34, 197, 94, 0.14);
        }

        .dp-cell-match:hover {
            box-shadow: var(--glow-match);
        }

        .dp-cell-current {
            background: var(--accent-soft-strong);
            z-index: 1;
            animation: highlight-cell 1.5s infinite;
            box-shadow: var(--glow-accent);
            border-color: var(--accent);
        }

        @keyframes highlight-cell {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .dp-cell-trace {
            background: rgba(251, 191, 36, 0.15);
            z-index: 2;
            box-shadow: var(--glow-trace);
            border-color: var(--trace);
            animation: pulse-trace 2s infinite;
        }

        [data-theme="light"] .dp-cell-trace {
            background: rgba(59, 130, 246, 0.15);
            box-shadow: var(--glow-trace);
            border-color: var(--trace);
            animation: pulse-trace-light 2s infinite;
        }

        .dp-cell-inner {
            display: flex;
            flex-direction: column;
            gap: 1px;
            align-items: center;
            justify-content: center;
            min-height: 24px;
        }

        .dp-val {
            font-size: 10px;
            font-weight: 500;
        }

        .dp-arrow {
            font-size: 8px;
            color: var(--text-muted);
            opacity: 0.86;
        }

        .dp-empty {
            color: var(--text-muted);
            opacity: 0.5;
        }

        .code-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .code-box {
            border-radius: var(--radius-md);
            border: 1px solid var(--border-subtle);
            background: var(--bg-panel-soft);
            padding: 8px;
            font-size: 10px;
            font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas,
                "Liberation Mono", "Courier New", monospace;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
            flex: 1;
            transition: all var(--transition-med);
        }

        .code-box:hover {
            border-color: var(--accent);
            box-shadow: 0 4px 20px rgba(56, 189, 248, 0.15);
        }

        .code-title-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 6px;
            color: var(--text-muted);
            font-size: 9px;
            flex-shrink: 0;
        }

        .code-title-row span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .code-lines {
            border-radius: 6px;
            background: var(--bg-panel);
            padding: 6px;
            overflow-y: auto;
            flex: 1;
            min-height: 0;
            border: 1px solid var(--border-subtle);
        }

        .code-line {
            padding: 4px 6px;
            border-radius: 4px;
            white-space: pre;
            transition: all var(--transition-med);
            margin-bottom: 2px;
            font-size: 11px;
            line-height: 1.4;
            position: relative;
        }

        .code-line::before {
            content: "";
            position: absolute;
            left: -4px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--accent);
            opacity: 0;
            transition: opacity var(--transition-med);
        }

        .code-line-active {
            background: var(--accent-soft);
            color: var(--accent);
            font-weight: 500;
            box-shadow: 0 0 0 1px var(--accent-soft-strong);
            animation: code-pulse 2s infinite;
        }

        .code-line-active::before {
            opacity: 1;
        }

        @keyframes code-pulse {
            0% { box-shadow: 0 0 0 0 var(--accent-soft-strong); }
            70% { box-shadow: 0 0 0 4px transparent; }
            100% { box-shadow: 0 0 0 0 transparent; }
        }

        .backtracking-visual {
            margin-top: 8px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-subtle);
            background: var(--bg-panel-soft);
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            transition: all var(--transition-med);
        }

        .backtracking-visual:hover {
            border-color: var(--accent);
            box-shadow: 0 4px 20px rgba(56, 189, 248, 0.15);
        }

        .backtracking-title {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.12em;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .backtracking-title span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .backtracking-path {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            min-height: 40px;
        }

        .path-cell {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-subtle);
            background: var(--bg-panel-soft);
            font-size: 10px;
            position: relative;
            transition: all var(--transition-fast);
        }

        .path-cell.path-match {
            background: rgba(34, 197, 94, 0.2);
            border-color: var(--match);
            color: var(--match);
            font-weight: bold;
            animation: pulse-match 2s infinite;
        }

        .path-cell.path-trace {
            background: rgba(251, 191, 36, 0.2);
            border-color: var(--trace);
        }

        [data-theme="light"] .path-cell.path-trace {
            background: rgba(59, 130, 246, 0.2);
            border-color: var(--trace);
        }

        .path-cell.path-start {
            background: var(--accent-soft);
            border-color: var(--accent);
            font-weight: bold;
        }

        .path-arrow {
            color: var(--text-muted);
            font-size: 12px;
        }

        .help-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 14px;
            height: 14px;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            background: var(--accent-soft);
            font-size: 9px;
            color: var(--accent);
            cursor: help;
            transition: all var(--transition-fast);
        }

        .help-icon:hover {
            border-color: var(--accent);
            transform: scale(1.1);
            box-shadow: var(--glow-accent);
        }

        footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            font-size: 9px;
            color: var(--text-muted);
            padding: 0 4px;
            flex-shrink: 0;
        }

        footer span {
            opacity: 0.7;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        i {
            opacity: 0.8;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .test-main-container {
                flex-direction: column;
                height: calc(100vh - 180px);
            }
            
            .question-panel, .visualization-panel {
                min-height: 45%;
            }
            
            .layout {
                grid-template-columns: 320px 1fr;
            }
            
            .premium-slider-marks {
                display: none;
            }
            
            .slider-container {
                padding: 8px 0;
            }
        }

        @media (max-width: 1000px) {
            .dp-visualization-area {
                flex-direction: column;
            }
            
            .dp-table-section, .code-section {
                flex: 1;
            }
            
            .premium-slider {
                --slider-height: 3px;
                --thumb-size: 14px;
            }
            
            .slider-container {
                height: 18px;
            }
            
            .slider-value {
                min-width: 45px;
                font-size: 8px;
            }
        }

        @media (max-width: 900px) {
            .layout {
                grid-template-columns: 1fr;
                overflow-y: auto;
            }
            
            .app-shell {
                overflow-y: auto;
            }
        }

        @media (max-width: 768px) {
            .test-header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .test-header-left {
                flex-direction: column;
            }
            
            .progress-container {
                min-width: 100%;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .navigation {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }
            
            .results-card {
                padding: 30px 20px;
            }
            
            .results-card .btn {
                width: auto;
                min-width: 150px;
            }
        }

        /* Mobile touch improvements */
        @media (hover: none) and (pointer: coarse) {
            .premium-slider-thumb {
                width: 20px;
                height: 20px;
            }
            
            .slider-mark {
                padding: 3px 5px;
                margin: 0 2px;
            }
            
            .chip, button {
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <div class="mode-navigation">
        <button class="mode-btn active" data-mode="main">
            <i class="fas fa-play-circle"></i> Main Visualizer
        </button>
        <button class="mode-btn" data-mode="pretest">
            <i class="fas fa-clipboard-check"></i> Pre-test
        </button>
        <button class="mode-btn" data-mode="posttest">
            <i class="fas fa-chart-line"></i> Post-test
        </button>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Main Visualizer Page -->
        <div id="main-page" class="page-section active">
            <div class="app-shell">
                <div class="app-content">
                    <header class="app-header">
                        <div class="title-block">
                            <div class="title-row">
                                <div class="app-title">
                                    <i class="fas fa-code-branch"></i>
                                    <span class="title-text">LCS Virtual Lab - DEI</span>
                                    <span class="icon-dot"></span>
                                </div>
                                <div class="app-title-pill">Dayalbagh Educational Institute, Faculty of Engineering.</div>
                            </div>
                            <div class="title-sub">
                                Longest Common Subsequence  Compare algorithms and visualize backtracking
                            </div>
                        </div>
                        <div class="header-right">
                            <div class="badge-soft" id="modeToggle">
                                <i class="fas fa-graduation-cap"></i>
                                Interactive Learning Mode
                            </div>
                            <div class="theme-toggle" id="themeToggle">
                                <span class="theme-toggle-icon" id="themeIcon"></span>
                                <span class="theme-toggle-text" id="themeText">Dark</span>
                            </div>
                        </div>
                    </header>

                    <main class="layout">
                        <section class="panel">
                            <div class="panel-header">
                                <div class="panel-title">
                                    <i class="fas fa-sliders-h"></i>
                                    Inputs  Control
                                </div>
                            </div>

                            <div class="algorithm-selector">
                                <div class="algo-tab active" data-algo="standard">
                                    <i class="fas fa-table"></i>
                                    Standard O(n)
                                </div>
                                <div class="algo-tab" data-algo="rolling">
                                    <i class="fas fa-layer-group"></i>
                                    Rolling Array O(n)
                                </div>
                                <div class="algo-tab" data-algo="hirschberg">
                                    <i class="fas fa-code-branch"></i>
                                    Hirschberg O(n)
                                </div>
                            </div>
                            <div class="algo-info" id="algoInfo">
                                <strong><i class="fas fa-info-circle"></i> Standard DP:</strong> Builds full DP table, O(n) space, allows full backtracking
                            </div>

                            <div class="inputs-group">
                                <div class="input-row">
                                    <label for="seqA">
                                        <span><i class="fas fa-font"></i> Sequence A</span>
                                        <span class="key">A[1..n]</span>
                                    </label>
                                    <input
                                        id="seqA"
                                        type="text"
                                        placeholder="e.g. AGGTAB"
                                        autocomplete="off"
                                    />
                                </div>

                                <div class="input-row">
                                    <label for="seqB">
                                        <span><i class="fas fa-font"></i> Sequence B</span>
                                        <span class="key">B[1..m]</span>
                                    </label>
                                    <input
                                        id="seqB"
                                        type="text"
                                        placeholder="e.g. GXTXAYB"
                                        autocomplete="off"
                                    />
                                    <div class="hint-text">
                                        <i class="fas fa-lightbulb"></i> Start with short strings (5-8 chars) to see the algorithm clearly
                                    </div>
                                </div>

                                <div class="preset-row">
                                    <div class="chip" data-preset="classic">
                                        <i class="fas fa-star"></i> Classic
                                    </div>
                                    <div class="chip" data-preset="match-heavy">
                                        <i class="fas fa-handshake"></i> Match-heavy
                                    </div>
                                    <div class="chip" data-preset="almost-equal">
                                        <i class="fas fa-equals"></i> Almost equal
                                    </div>
                                    <div class="chip" data-preset="simple">
                                        <i class="fas fa-baby"></i> Simple
                                    </div>
                                </div>
                            </div>

                            <div class="controls-row" style="margin-top: 6px;">
                                <button id="initBtn" class="primary">
                                    <i class="fas fa-play"></i> Initialize
                                </button>
                                <button id="stepBtn">
                                    <i class="fas fa-step-forward"></i> Step
                                </button>
                                <button id="playBtn">
                                    <i class="fas fa-play-circle"></i> Auto-play
                                </button>
                                <button id="pauseBtn">
                                    <i class="fas fa-pause"></i> Pause
                                </button>
                                <button id="resetBtn">
                                    <i class="fas fa-redo"></i> Reset
                                </button>
                            </div>

                            <div class="slider-row premium-slider">
                                <span><i class="fas fa-tachometer-alt"></i> Speed</span>
                                <div class="slider-container">
                                    <div class="premium-slider-track">
                                        <div class="premium-slider-fill" id="sliderFill"></div>
                                    </div>
                                    <input 
                                        class="premium-slider-input" 
                                        id="speedSlider" 
                                        type="range" 
                                        min="20" 
                                        max="1500" 
                                        step="20" 
                                        value="500"
                                    />
                                    <div class="premium-slider-thumb" id="sliderThumb"></div>
                                </div>
                                <span class="slider-value" id="speedLabel">500ms</span>
                                
                                <div class="premium-slider-marks" id="speedMarks">
                                    <div class="slider-mark" data-value="20">20ms</div>
                                    <div class="slider-mark" data-value="150">150ms</div>
                                    <div class="slider-mark" data-value="500">500ms</div>
                                    <div class="slider-mark" data-value="1000">1s</div>
                                    <div class="slider-mark" data-value="1500">1.5s</div>
                                </div>
                            </div>

                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-label">
                                        <i class="fas fa-ruler"></i> Lengths (n, m)
                                    </div>
                                    <div class="stat-value"><span id="stats-n">0</span>, <span id="stats-m">0</span></div>
                                    <div class="stat-badge">Size</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">
                                        <i class="fas fa-memory"></i> Space
                                    </div>
                                    <div class="stat-value"><span id="stats-space">0</span></div>
                                    <div class="stat-badge">Complexity</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-label">
                                        <i class="fas fa-tasks"></i> Progress
                                    </div>
                                    <div class="stat-value"><span id="stats-step">0</span>/<span id="stats-total">0</span></div>
                                    <div class="stat-badge">Steps</div>
                                </div>
                            </div>

                            <div class="explanation-box">
                                <div class="explanation-title">
                                    <span><i class="fas fa-comment-alt"></i> Step explanation</span>
                                    <span class="help-icon" title="This shows what's happening in the current step">
                                        <i class="fas fa-question"></i>
                                    </span>
                                </div>
                                <div id="explanation-text">
                                    Enter two sequences and click "Initialize" to begin. Watch the characters compare step-by-step above the DP table!
                                </div>
                                <div class="lcs-output-row">
                                    <div>
                                        <i class="fas fa-ruler-vertical"></i> LCS length:
                                        <span id="lcs-length">0</span>
                                    </div>
                                    <div>
                                        <i class="fas fa-code"></i> LCS:
                                        <span id="lcs-string"></span>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section class="panel">
                            <div class="panel-header">
                                <div class="panel-title">
                                    <i class="fas fa-eye"></i> Visualization
                                </div>
                                <div class="panel-subtitle">
                                    Watch characters being compared, then see the DP table update
                                </div>
                            </div>

                            <div class="right-panel-content">
                                <div class="visual-comparison" id="visualComparison">
                                    <div class="comparison-title">
                                        <span><i class="fas fa-exchange-alt"></i> Character Comparison</span>
                                        <span class="help-icon" title="See which characters are being compared in the current step">
                                            <i class="fas fa-question"></i>
                                        </span>
                                    </div>
                                    <div class="comparison-strings">
                                        <div class="string-display">
                                            <div class="string-label">
                                                <span><i class="fas fa-stream"></i> Sequence A:</span>
                                                <span style="color: var(--accent);">n = <span id="vis-lenA">0</span></span>
                                            </div>
                                            <div class="string-chars" id="charsA"></div>
                                        </div>
                                        <div class="comparison-arrow" id="comparisonArrow">
                                            <i class="fas fa-arrow-down"></i> Comparing...
                                        </div>
                                        <div class="string-display">
                                            <div class="string-label">
                                                <span><i class="fas fa-stream"></i> Sequence B:</span>
                                                <span style="color: #a78bfa;">m = <span id="vis-lenB">0</span></span>
                                            </div>
                                            <div class="string-chars" id="charsB"></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="dp-wrapper">
                                    <div class="dp-header-row">
                                        <div id="dp-table-title">
                                            <i class="fas fa-table"></i> DP Table dp[i][j]
                                        </div>
                                        <div class="legend-row">
                                            <div class="legend-chip">
                                                <span class="legend-color base"></span>
                                                base
                                            </div>
                                            <div class="legend-chip">
                                                <span class="legend-color match"></span>
                                                match
                                            </div>
                                            <div class="legend-chip">
                                                <span class="legend-color current"></span>
                                                current
                                            </div>
                                            <div class="legend-chip">
                                                <span class="legend-color trace"></span>
                                                trace
                                            </div>
                                        </div>
                                    </div>

                                    <div class="dp-visualization-area">
                                        <div class="dp-table-section">
                                            <div class="dp-table-container">
                                                <div class="dp-table-scroll" id="dp-table-container">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="code-section">
                                            <div class="code-box">
                                                <div class="code-title-row">
                                                    <span><i class="fas fa-code"></i> Pseudocode</span>
                                                    <span id="code-description">Standard DP</span>
                                                </div>
                                                <div class="code-lines" id="codeLines">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="backtracking-visual" id="backtrackingVisual">
                                        <div class="backtracking-title">
                                            <span><i class="fas fa-sitemap"></i> Backtracking Path</span>
                                            <span class="help-icon" title="Shows the path taken to recover the LCS from the DP table">
                                                <i class="fas fa-question"></i>
                                            </span>
                                        </div>
                                        <div class="backtracking-path" id="backtrackingPath">
                                            <div style="color: var(--text-muted); font-size: 9px; padding: 10px; text-align: center;">
                                                <i class="fas fa-info-circle"></i> Backtracking will appear here after DP table is filled
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </main>

                    <footer>
                        <span>
                            <i class="fas fa-lightbulb"></i> Tip: Watch the character boxes highlight to see comparisons before the table updates!
                        </span>
                        <span>
                            <i class="fas fa-desktop"></i> Best viewed with short strings (5-10 characters) for clear visualization
                        </span>
                    </footer>
                </div>
            </div>
        </div>

        <!-- Pre-test Page -->
        <div id="pretest-page" class="page-section">
            <div class="test-header">
                <div class="test-header-content">
                    <div class="test-header-left">
                        <div class="test-icon">
                            <i class="fas fa-clipboard-check"></i>
                        </div>
                        <div class="header-text">
                            <h1>Dynamic Programming Lab - Pre-test</h1>
                            <p>Test your foundational knowledge of DP concepts before the lab simulation</p>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-info">
                            <span>Question <span id="pretest-current-question">1</span>/<span id="pretest-total-questions">10</span></span>
                            <span><span id="pretest-correct-count">0</span> Correct</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="pretest-progress-fill"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="test-main-container">
                <div class="question-panel">
                    <div class="question-header">
                        <div class="question-number" id="pretest-question-number">Question 1</div>
                        <div class="question-text" id="pretest-question-text">
                            What is a <i>subsequence</i> of a string?
                        </div>
                    </div>
                    
                    <div class="options-grid" id="pretest-options-container">
                    </div>
                    
                    <div class="feedback-area" id="pretest-feedback-area">
                        <div class="feedback-text" id="pretest-feedback-text">
                            <i class="fas fa-check-circle"></i> Correct!
                        </div>
                        <div class="feedback-explanation" id="pretest-feedback-explanation">
                            Explanation will appear here.
                        </div>
                    </div>
                    
                    <div class="navigation">
                        <button class="btn btn-secondary" id="pretest-prev-btn" disabled>
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn btn-primary" id="pretest-next-btn" disabled>
                            Next Question <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="visualization-panel">
                    <div class="visualization-header">
                        <div class="visual-title">
                            <i class="fas fa-lightbulb"></i> Concept Visualization
                        </div>
                        <div class="visual-subtitle" id="pretest-visual-subtitle">
                            Select an option to see detailed explanation
                        </div>
                    </div>
                    <div class="visual-content" id="pretest-visual-content">
                        <div class="default-visualization">
                            <i class="fas fa-mouse-pointer"></i>
                            <h3>Select an Answer</h3>
                            <p>Choose one of the options to see detailed explanation and visualization here.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="results-overlay" id="pretest-results-overlay">
                <div class="results-card">
                    <div class="results-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <h2>Pre-test Completed!</h2>
                    <div class="score-display" id="pretest-final-score">0/10</div>
                    <div class="score-text" id="pretest-score-message">Your score will appear here</div>
                    <div class="feedback" id="pretest-final-feedback" style="margin: 20px 0; font-weight: 600;"></div>
                    <p style="margin-bottom: 30px;" id="pretest-completion-message">You are now ready to proceed to the Dynamic Programming Lab Simulation.</p>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button class="btn btn-secondary" id="pretest-retake-btn">
                            <i class="fas fa-redo"></i> Retake Test
                        </button>
                        <button class="btn btn-primary" id="pretest-proceed-btn" style="display: none;">
                            Proceed to Lab <i class="fas fa-flask"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Post-test Page -->
        <div id="posttest-page" class="page-section posttest">
            <div class="test-header">
                <div class="test-header-content">
                    <div class="test-header-left">
                        <div class="test-icon">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <div class="header-text">
                            <h1>Dynamic Programming Lab - Post-test</h1>
                            <p>Evaluate your understanding after completing the lab simulation</p>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-info">
                            <span>Question <span id="posttest-current-question">1</span>/<span id="posttest-total-questions">10</span></span>
                            <span><span id="posttest-correct-count">0</span> Correct</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="posttest-progress-fill"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="test-main-container">
                <div class="question-panel">
                    <div class="question-header">
                        <div class="question-number" id="posttest-question-number">Question 1</div>
                        <div class="question-text" id="posttest-question-text">
                            Why do we add <code>+1</code> in LCS DP when characters match?
                        </div>
                    </div>
                    
                    <div class="options-grid" id="posttest-options-container">
                    </div>
                    
                    <div class="feedback-area" id="posttest-feedback-area">
                        <div class="feedback-text" id="posttest-feedback-text">
                            <i class="fas fa-check-circle"></i> Correct!
                        </div>
                        <div class="feedback-explanation" id="posttest-feedback-explanation">
                            Explanation will appear here.
                        </div>
                    </div>
                    
                    <div class="navigation">
                        <button class="btn btn-secondary" id="posttest-prev-btn" disabled>
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn btn-primary" id="posttest-next-btn" disabled>
                            Next Question <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="visualization-panel">
                    <div class="visualization-header">
                        <div class="visual-title">
                            <i class="fas fa-project-diagram"></i> Concept Visualization
                        </div>
                        <div class="visual-subtitle" id="posttest-visual-subtitle">
                            Select an option to see detailed explanation
                        </div>
                    </div>
                    <div class="visual-content" id="posttest-visual-content">
                        <div class="default-visualization">
                            <i class="fas fa-mouse-pointer"></i>
                            <h3>Select an Answer</h3>
                            <p>Choose one of the options to see detailed explanation and visualization here.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="results-overlay" id="posttest-results-overlay">
                <div class="results-card">
                    <div class="results-icon">
                        <i class="fas fa-medal"></i>
                    </div>
                    <h2>Post-test Completed!</h2>
                    <div class="score-display" id="posttest-final-score">0/10</div>
                    <div class="score-text" id="posttest-score-message">Your score will appear here</div>
                    <div class="feedback" id="posttest-final-feedback" style="margin: 20px 0; font-weight: 600;"></div>
                    <p style="margin-bottom: 30px;" id="posttest-completion-message">You have completed the Dynamic Programming Lab Simulation assessment.</p>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button class="btn btn-secondary" id="posttest-retake-btn">
                            <i class="fas fa-redo"></i> Retake Test
                        </button>
                        <button class="btn btn-primary" id="posttest-review-btn" style="display: none;">
                            <i class="fas fa-chart-bar"></i> Review Performance
                        </button>
                        <button class="btn btn-primary" id="posttest-proceed-btn" style="display: none;">
                            Return to Main Page <i class="fas fa-home"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Navigation Logic
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const mode = btn.dataset.mode;
                
                // Update active button
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // Show corresponding page
                document.querySelectorAll('.page-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(`${mode}-page`).classList.add('active');
            });
        });

        // Theme Toggle Logic
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            
            // Update toggle button
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            
            if (newTheme === 'light') {
                themeIcon.textContent = '';
                themeText.textContent = 'Light';
            } else {
                themeIcon.textContent = '';
                themeText.textContent = 'Dark';
            }
            
            // Save preference
            localStorage.setItem('dp-lab-theme', newTheme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('dp-lab-theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            // Update toggle button
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            
            if (savedTheme === 'light') {
                themeIcon.textContent = '';
                themeText.textContent = 'Light';
            } else {
                themeIcon.textContent = '';
                themeText.textContent = 'Dark';
            }
        }

        document.getElementById('themeToggle').addEventListener('click', toggleTheme);
        document.addEventListener('DOMContentLoaded', loadTheme);

        // Main Visualizer Script
        (function () {
            const state = {
                a: "",
                b: "",
                n: 0,
                m: 0,
                dp: [],
                dir: [],
                phase: "idle",
                i: 1,
                j: 1,
                lastFillI: null,
                lastFillJ: null,
                traceI: null,
                traceJ: null,
                lastTraceI: null,
                lastTraceJ: null,
                playing: false,
                intervalId: null,
                speed: 500,
                lcsChars: [],
                totalSteps: 0,
                currentStep: 0,
                theme: "dark",
                algorithm: "standard",
                backtrackingPath: [],
                rollingDP: null
            };

            const els = {};

            const pseudocode = {
                standard: [
                    { code: "outer", text: "for i  1 to n:" },
                    { code: "inner", text: "  for j  1 to m:" },
                    { code: "if", text: "    if A[i] == B[j]:" },
                    { code: "match", text: "      dp[i][j]  dp[i-1][j-1] + 1" },
                    { code: "else", text: "    else:" },
                    { code: "mismatch", text: "      dp[i][j]  max(dp[i-1][j], dp[i][j-1])" },
                    { code: "trace", text: "# traceback from (n,m) to recover LCS" }
                ],
                rolling: [
                    { code: "init", text: "prev  array[0..m]" },
                    { code: "outer", text: "for i  1 to n:" },
                    { code: "inner", text: "  curr[0]  0" },
                    { code: "forj", text: "  for j  1 to m:" },
                    { code: "if", text: "    if A[i] == B[j]:" },
                    { code: "match", text: "      curr[j]  prev[j-1] + 1" },
                    { code: "else", text: "    else:" },
                    { code: "mismatch", text: "      curr[j]  max(prev[j], curr[j-1])" },
                    { code: "swap", text: "  prev  curr" },
                    { code: "result", text: "# result in prev[m]" }
                ],
                hirschberg: [
                    { code: "func", text: "function Hirschberg(A, B):" },
                    { code: "base", text: "  if |A| == 0 or |B| == 0:" },
                    { code: "return", text: "    return ''" },
                    { code: "mid", text: "  mid  |A| / 2" },
                    { code: "l1", text: "  L1  LCSLength(A[1..mid], B)" },
                    { code: "l2", text: "  L2  LCSLength(reverse(A[mid+1..]), reverse(B))" },
                    { code: "cut", text: "  cut  argmax(L1[j] + L2[m-j])" },
                    { code: "recurse", text: "  return Hirschberg(A[1..mid], B[1..cut]) +" },
                    { code: "recurse2", text: "         Hirschberg(A[mid+1..], B[cut+1..])" }
                ]
            };

            function grab(id) {
                return document.getElementById(id);
            }

            function cacheElements() {
                els.seqA = grab("seqA");
                els.seqB = grab("seqB");
                els.initBtn = grab("initBtn");
                els.stepBtn = grab("stepBtn");
                els.playBtn = grab("playBtn");
                els.pauseBtn = grab("pauseBtn");
                els.resetBtn = grab("resetBtn");
                els.speedSlider = grab("speedSlider");
                els.speedLabel = grab("speedLabel");

                els.statsN = grab("stats-n");
                els.statsM = grab("stats-m");
                els.statsSpace = grab("stats-space");
                els.statsStep = grab("stats-step");
                els.statsTotal = grab("stats-total");

                els.explanation = grab("explanation-text");
                els.lcsLength = grab("lcs-length");
                els.lcsString = grab("lcs-string");

                els.visLenA = grab("vis-lenA");
                els.visLenB = grab("vis-lenB");
                els.charsA = grab("charsA");
                els.charsB = grab("charsB");
                els.comparisonArrow = grab("comparisonArrow");

                els.dpTableContainer = grab("dp-table-container");
                els.dpTableTitle = grab("dp-table-title");
                els.codeLines = grab("codeLines");
                els.codeDescription = grab("code-description");
                els.algoInfo = grab("algoInfo");
                
                els.backtrackingVisual = grab("backtrackingVisual");
                els.backtrackingPath = grab("backtrackingPath");
            }

            function setAlgorithm(algo) {
                if (state.algorithm === algo) return;
                
                state.algorithm = algo;
                
                document.querySelectorAll('.algo-tab').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.algo === algo);
                });
                
                const algoInfo = {
                    standard: "<strong><i class='fas fa-info-circle'></i> Standard DP:</strong> Builds full DP table, O(n) space, allows full backtracking",
                    rolling: "<strong><i class='fas fa-info-circle'></i> Rolling Array:</strong> Uses only 2 rows, O(n) space, can reconstruct with extra steps",
                    hirschberg: "<strong><i class='fas fa-info-circle'></i> Hirschberg:</strong> Divide & conquer, O(n) space, optimal for large sequences"
                };
                els.algoInfo.innerHTML = algoInfo[algo];
                
                els.codeDescription.textContent = 
                    algo === "standard" ? "Standard DP" : 
                    algo === "rolling" ? "Rolling Array" : "Hirschberg's Algorithm";
                
                renderPseudocode();
                
                stopAutoPlay();
                
                if (state.n > 0 && state.m > 0) {
                    initDp();
                }
            }

            function renderPseudocode() {
                const code = pseudocode[state.algorithm];
                let html = '';
                code.forEach(line => {
                    html += `<div class="code-line" data-code="${line.code}">${line.text}</div>`;
                });
                els.codeLines.innerHTML = html;
            }

            function escapeHtml(str) {
                return str
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#39;");
            }

            function updateSpeedLabel() {
                const value = state.speed;
                if (value >= 1000) {
                    els.speedLabel.textContent = (value / 1000).toFixed(1) + 's';
                } else {
                    els.speedLabel.textContent = value + 'ms';
                }
            }

            function updateStats() {
                els.statsN.textContent = state.n;
                els.statsM.textContent = state.m;
                
                const space = state.algorithm === "standard" ? state.n * state.m : 
                             state.algorithm === "rolling" ? 2 * state.m :
                             state.m;
                els.statsSpace.textContent = space || 0;
                
                els.visLenA.textContent = state.n;
                els.visLenB.textContent = state.m;

                els.statsStep.textContent = state.currentStep;
                els.statsTotal.textContent = state.totalSteps;
            }

            function setExplanation(text) {
                els.explanation.innerHTML = text;
            }

            function setLcsDisplay() {
                const lcs = state.lcsChars.join("");
                els.lcsString.textContent = lcs || "";
                els.lcsLength.textContent = lcs.length;
            }

            function clearLcsDisplay() {
                state.lcsChars = [];
                setLcsDisplay();
            }

            function highlightCode(which) {
                document.querySelectorAll("#codeLines .code-line").forEach((line) => {
                    const codeId = line.getAttribute("data-code");
                    if (codeId === which) {
                        line.classList.add("code-line-active");
                    } else {
                        line.classList.remove("code-line-active");
                    }
                });
            }

            function renderCharBoxes() {
                const a = state.a;
                const b = state.b;
                
                let htmlA = "";
                for (let i = 0; i < a.length; i++) {
                    const idx = i + 1;
                    htmlA += `<div class="char-box" data-char-a="${idx}">
                        <span class="char-box-index">${idx}</span>
                        ${escapeHtml(a[i])}
                    </div>`;
                }
                els.charsA.innerHTML = htmlA || '<div style="color: var(--text-muted); font-size: 10px;"><i class="fas fa-exclamation-circle"></i> No characters</div>';

                let htmlB = "";
                for (let j = 0; j < b.length; j++) {
                    const idx = j + 1;
                    htmlB += `<div class="char-box" data-char-b="${idx}">
                        <span class="char-box-index">${idx}</span>
                        ${escapeHtml(b[j])}
                    </div>`;
                }
                els.charsB.innerHTML = htmlB || '<div style="color: var(--text-muted); font-size: 10px;"><i class="fas fa-exclamation-circle"></i> No characters</div>';
            }

            function updateCharHighlights() {
                document.querySelectorAll('.char-box').forEach(box => {
                    box.classList.remove('char-box-current-a', 'char-box-current-b', 'char-box-match', 'char-box-in-lcs');
                });

                if (state.phase === "filling" && state.lastFillI !== null && state.lastFillJ !== null) {
                    const i = state.lastFillI;
                    const j = state.lastFillJ;
                    
                    const charBoxA = document.querySelector(`[data-char-a="${i}"]`);
                    const charBoxB = document.querySelector(`[data-char-b="${j}"]`);
                    
                    if (charBoxA) charBoxA.classList.add('char-box-current-a');
                    if (charBoxB) charBoxB.classList.add('char-box-current-b');

                    if (state.a[i - 1] === state.b[j - 1]) {
                        if (charBoxA) charBoxA.classList.add('char-box-match');
                        if (charBoxB) charBoxB.classList.add('char-box-match');
                    }

                    els.comparisonArrow.classList.add('visible');
                    els.comparisonArrow.innerHTML = 
                        state.a[i - 1] === state.b[j - 1] 
                            ? `<i class="fas fa-check-circle"></i> Match! A[${i}] = B[${j}] = '${state.a[i - 1]}'`
                            : `<i class="fas fa-times-circle"></i> Different: A[${i}] = '${state.a[i - 1]}', B[${j}] = '${state.b[j - 1]}'`;
                } else {
                    els.comparisonArrow.classList.remove('visible');
                }
            }

            function renderBacktrackingPath() {
                if (state.algorithm !== "standard" || state.backtrackingPath.length === 0) {
                    els.backtrackingPath.innerHTML = 
                        '<div style="color: var(--text-muted); font-size: 9px; padding: 10px; text-align: center;">' +
                        (state.algorithm === "standard" 
                            ? '<i class="fas fa-info-circle"></i> Backtracking path will appear here after DP table is filled' 
                            : '<i class="fas fa-info-circle"></i> Full backtracking only available in Standard DP algorithm') +
                        '</div>';
                    return;
                }

                let html = '';
                let prevCell = null;
                
                state.backtrackingPath.forEach((cell, idx) => {
                    const [i, j, isMatch] = cell;
                    const char = isMatch ? state.a[i-1] : '';
                    
                    if (prevCell) {
                        html += `<div class="path-arrow"><i class="fas fa-arrow-right"></i></div>`;
                    }
                    
                    let cellClass = "path-cell";
                    if (isMatch) cellClass += " path-match";
                    if (idx === 0) cellClass += " path-start";
                    else if (idx === state.backtrackingPath.length - 1) cellClass += " path-trace";
                    
                    html += `<div class="${cellClass}" title="(${i}, ${j})${isMatch ? ` - Match: ${char}` : ''}">
                        ${isMatch ? `<i class="fas fa-check"></i> ${char}` : `${i},${j}`}
                    </div>`;
                    
                    prevCell = cell;
                });
                
                els.backtrackingPath.innerHTML = html;
            }

            function initDp() {
                const a = (els.seqA.value || "").trim();
                const b = (els.seqB.value || "").trim();

                state.a = a;
                state.b = b;
                state.n = a.length;
                state.m = b.length;

                if (state.n === 0 || state.m === 0) {
                    setExplanation("<i class='fas fa-exclamation-triangle'></i> One sequence is empty. LCS length is 0. Try entering both sequences!");
                } else if (state.n * state.m > 900 && state.algorithm === "standard") {
                    setExplanation(
                        "<i class='fas fa-exclamation-triangle'></i> Large table! Animation may be slower. Try rolling array or Hirschberg algorithm for better performance."
                    );
                } else {
                    setExplanation(`<i class='fas fa-check-circle'></i> Table initialized using ${state.algorithm} algorithm! Click 'Step' to see each comparison.`);
                }

                state.totalSteps = state.n * state.m + 1;
                state.currentStep = 0;
                state.backtrackingPath = [];
                updateStats();
                clearLcsDisplay();
                renderCharBoxes();
                updateCharHighlights();
                renderBacktrackingPath();

                if (state.algorithm === "standard") {
                    state.dp = Array.from({ length: state.n + 1 }, () =>
                        Array(state.m + 1).fill(0)
                    );
                    state.dir = Array.from({ length: state.n + 1 }, () =>
                        Array(state.m + 1).fill(null)
                    );
                } else if (state.algorithm === "rolling") {
                    state.dp = [
                        Array(state.m + 1).fill(0),
                        Array(state.m + 1).fill(0)
                    ];
                    state.dir = Array.from({ length: state.n + 1 }, () =>
                        Array(state.m + 1).fill(null)
                    );
                } else if (state.algorithm === "hirschberg") {
                    const rowsToShow = Math.min(state.n, 10);
                    state.dp = Array.from({ length: rowsToShow + 1 }, () =>
                        Array(state.m + 1).fill(0)
                    );
                    state.dir = Array.from({ length: state.n + 1 }, () =>
                        Array(state.m + 1).fill(null)
                    );
                }

                state.phase = "filling";
                state.i = 1;
                state.j = 1;
                state.lastFillI = null;
                state.lastFillJ = null;
                state.traceI = null;
                state.traceJ = null;
                state.lastTraceI = null;
                state.lastTraceJ = null;

                renderDpTable();
                highlightCode(state.algorithm === "rolling" ? "init" : "outer");
            }

            function renderDpTable() {
                const n = state.n;
                const m = state.m;
                const a = state.a;
                const b = state.b;
                const dp = state.dp;
                const dir = state.dir;

                if (state.algorithm === "rolling") {
                    els.dpTableTitle.innerHTML = `<i class='fas fa-layer-group'></i> Rolling Array (row ${state.i > 0 ? state.i : 1} of ${n})`;
                } else if (state.algorithm === "hirschberg") {
                    els.dpTableTitle.innerHTML = `<i class='fas fa-code-branch'></i> Hirschberg Algorithm (simplified)`;
                } else {
                    els.dpTableTitle.innerHTML = `<i class='fas fa-table'></i> DP Table dp[i][j]`;
                }

                let html = '<table class="dp-table"><thead><tr>';
                html += '<th class="corner header-cell">dp</th>';
                html += '<th class="header-cell"></th>';
                for (let j = 1; j <= m; j++) {
                    html +=
                        '<th class="header-cell">' + escapeHtml(b[j - 1] || "") + "<br><small style='font-size:8px;opacity:0.6;'>[" + j + "]</small></th>";
                }
                html += "</tr></thead><tbody>";

                const rowsToShow = state.algorithm === "hirschberg" ? Math.min(n, 10) : 
                                  state.algorithm === "rolling" ? Math.min(state.i, 2) : n;
                
                for (let i = 0; i <= rowsToShow; i++) {
                    if (state.algorithm === "rolling" && i > 1) continue;
                    
                    html += "<tr>";
                    if (i === 0) {
                        html += '<td class="header-col header-cell"></td>';
                    } else {
                        const rowIndex = state.algorithm === "rolling" ? 
                                        (i === 1 ? state.i - 1 : state.i) : i;
                        const displayChar = rowIndex <= n ? a[rowIndex - 1] : '';
                        html +=
                            '<td class="header-col header-cell">' + escapeHtml(displayChar || "") + 
                            "<br><small style='font-size:8px;opacity:0.6;'>[" + rowIndex + "]</small></td>";
                    }

                    for (let j = 0; j <= m; j++) {
                        const isBase = i === 0 || j === 0;
                        const rowIndex = state.algorithm === "rolling" ? 
                                        (i === 1 ? Math.max(0, state.i - 1) : state.i) : i;
                        const isMatch = rowIndex > 0 && j > 0 && 
                                       rowIndex <= n && j <= m && 
                                       a[rowIndex - 1] === b[j - 1];
                        const isCurrentFill =
                            state.phase === "filling" &&
                            ((state.algorithm === "rolling" && state.lastFillI === state.i && state.lastFillJ === j) ||
                             (state.algorithm !== "rolling" && state.lastFillI === i && state.lastFillJ === j));
                        const isTraceCell =
                            (state.phase === "trace" || state.phase === "done") &&
                            state.lastTraceI === i &&
                            state.lastTraceJ === j;

                        const classes = ["dp-cell"];
                        if (isBase) classes.push("dp-cell-base");
                        if (isMatch) classes.push("dp-cell-match");
                        if (isCurrentFill) classes.push("dp-cell-current");
                        if (isTraceCell) classes.push("dp-cell-trace");

                        let arrow = "";
                        if (!isBase && dir[rowIndex] && dir[rowIndex][j]) {
                            const d = dir[rowIndex][j];
                            if (d === "diag") arrow = "";
                            else if (d === "up") arrow = "";
                            else if (d === "left") arrow = "";
                        }

                        let val = "";
                        if (dp && dp[i]) {
                            val = dp[i][j] !== undefined ? dp[i][j] : "";
                        }
                        const valClass = val === "" ? "dp-empty" : "";

                        html += `<td class="${classes.join(" ")}">` +
                            '<div class="dp-cell-inner">' +
                            `<span class="dp-val ${valClass}">${val}</span>` +
                            `<span class="dp-arrow">${arrow}</span>` +
                            "</div></td>";
                    }

                    html += "</tr>";
                }

                if (state.algorithm === "hirschberg" && n > 10) {
                    html += `<tr><td colspan="${m+2}" style="text-align: center; color: var(--text-muted); font-size: 9px; padding: 8px;">
                        <i class="fas fa-ellipsis-h"></i> showing first 10 rows of ${n} total (Hirschberg uses divide & conquer)
                    </td></tr>`;
                } else if (state.algorithm === "rolling" && n > 2) {
                    html += `<tr><td colspan="${m+2}" style="text-align: center; color: var(--text-muted); font-size: 9px; padding: 8px;">
                        <i class="fas fa-ellipsis-h"></i> rolling array only stores current and previous rows
                    </td></tr>`;
                }

                html += "</tbody></table>";
                els.dpTableContainer.innerHTML = html;
            }

            function stepFilling() {
                const n = state.n;
                const m = state.m;
                const a = state.a;
                const b = state.b;

                if (n === 0 || m === 0) {
                    state.phase = "trace";
                    state.traceI = n;
                    state.traceJ = m;
                    setExplanation("<i class='fas fa-info-circle'></i> Trivial case: at least one sequence is empty, so LCS length is 0.");
                    highlightCode("trace");
                    renderDpTable();
                    updateCharHighlights();
                    return;
                }

                if (state.i > n) {
                    state.phase = "trace";
                    state.traceI = n;
                    state.traceJ = m;
                    state.lastFillI = null;
                    state.lastFillJ = null;
                    
                    if (state.algorithm === "standard") {
                        buildBacktrackingPath();
                    } else {
                        state.phase = "done";
                        const lcsLength = state.algorithm === "rolling" ? state.dp[1][m] : state.dp[Math.min(n, 10)][m];
                        setExplanation(`<i class='fas fa-check-circle'></i> Algorithm complete! LCS length = ${lcsLength}. Rolling array doesn't store full backtracking information.`);
                        highlightCode(state.algorithm === "rolling" ? "result" : "recurse");
                        renderDpTable();
                        updateCharHighlights();
                        renderBacktrackingPath();
                        return;
                    }
                    
                    setExplanation(`<i class='fas fa-check-circle'></i> DP table filled! LCS length = ${state.dp[n][m]}. Now tracing back from (${n}, ${m}) to find one LCS...`);
                    highlightCode("trace");
                    renderDpTable();
                    updateCharHighlights();
                    renderBacktrackingPath();
                    return;
                }

                const i = state.i;
                const j = state.j;

                const charA = a[i - 1];
                const charB = b[j - 1];

                state.currentStep++;
                let explain = "";

                if (state.algorithm === "rolling") {
                    highlightCode("if");
                    if (charA === charB) {
                        const val = (state.dp[0] ? state.dp[0][j - 1] : 0) + 1;
                        state.dp[1][j] = val;
                        state.dir[i][j] = "diag";
                        explain = `<i class="fas fa-check-circle" style="color: var(--match);"></i> <strong>MATCH!</strong> A[${i}]='${charA}', B[${j}]='${charB}'. curr[${j}] = prev[${j-1}] + 1 = ${val}.`;
                    } else {
                        const top = state.dp[0][j];
                        const left = state.dp[1][j - 1];
                        if (top >= left) {
                            state.dp[1][j] = top;
                            state.dir[i][j] = "up";
                            explain = `<i class="fas fa-times-circle" style="color: var(--danger);"></i> <strong>Different:</strong> A[${i}]='${charA}', B[${j}]='${charB}'. curr[${j}] = max(prev[${j}]=${top}, curr[${j-1}]=${left}) = ${top}.`;
                        } else {
                            state.dp[1][j] = left;
                            state.dir[i][j] = "left";
                            explain = `<i class="fas fa-times-circle" style="color: var(--danger);"></i> <strong>Different:</strong> A[${i}]='${charA}', B[${j}]='${charB}'. curr[${j}] = max(prev[${j}]=${top}, curr[${j-1}]=${left}) = ${left}.`;
                        }
                    }
                    
                    if (state.dp.length <= i) {
                        state.dp.push([...state.dp[1]]);
                    } else {
                        state.dp[i] = [...state.dp[1]];
                    }
                } else {
                    if (charA === charB) {
                        highlightCode("match");
                        const val = state.dp[i - 1][j - 1] + 1;
                        state.dp[i][j] = val;
                        state.dir[i][j] = "diag";
                        explain = `<i class="fas fa-check-circle" style="color: var(--match);"></i> <strong>MATCH!</strong> A[${i}]='${charA}', B[${j}]='${charB}'. dp[${i}][${j}] = dp[${i-1}][${j-1}] + 1 = ${val}.`;
                    } else {
                        highlightCode("mismatch");
                        const top = state.dp[i - 1][j];
                        const left = state.dp[i][j - 1];
                        if (top >= left) {
                            state.dp[i][j] = top;
                            state.dir[i][j] = "up";
                            explain = `<i class="fas fa-times-circle" style="color: var(--danger);"></i> <strong>Different:</strong> A[${i}]='${charA}', B[${j}]='${charB}'. dp[${i}][${j}] = max(${top}, ${left}) = ${top}.`;
                        } else {
                            state.dp[i][j] = left;
                            state.dir[i][j] = "left";
                            explain = `<i class="fas fa-times-circle" style="color: var(--danger);"></i> <strong>Different:</strong> A[${i}]='${charA}', B[${j}]='${charB}'. dp[${i}][${j}] = max(${top}, ${left}) = ${left}.`;
                        }
                    }
                }

                state.lastFillI = i;
                state.lastFillJ = j;
                setExplanation(explain);
                updateStats();

                state.j++;
                if (state.j > m) {
                    state.j = 1;
                    
                    if (state.algorithm === "rolling") {
                        state.dp[0] = [...state.dp[1]];
                        state.dp[1] = Array(m + 1).fill(0);
                        highlightCode("swap");
                    }
                    
                    state.i++;
                    if (state.i <= n) {
                        highlightCode(state.algorithm === "rolling" ? "forj" : "inner");
                    }
                }

                renderDpTable();
                updateCharHighlights();
            }

            function buildBacktrackingPath() {
                state.backtrackingPath = [];
                let i = state.n;
                let j = state.m;
                
                while (i > 0 && j > 0) {
                    const isMatch = state.dir[i][j] === "diag";
                    state.backtrackingPath.unshift([i, j, isMatch]);
                    
                    if (state.dir[i][j] === "diag") {
                        i--;
                        j--;
                    } else if (state.dir[i][j] === "up") {
                        i--;
                    } else {
                        j--;
                    }
                }
                
                if (i === 0 && j === 0) {
                    state.backtrackingPath.unshift([0, 0, false]);
                }
            }

            function stepTraceback() {
                const n = state.n;
                const m = state.m;
                const a = state.a;

                if (state.traceI === null || state.traceJ === null) {
                    state.traceI = n;
                    state.traceJ = m;
                }

                const i = state.traceI;
                const j = state.traceJ;

                if (i <= 0 || j <= 0) {
                    state.phase = "done";
                    setExplanation(
                        `<i class="fas fa-trophy" style="color: var(--trace);"></i> <strong>Traceback finished!</strong> Found LCS: "${state.lcsChars.join("")}" with length ${state.lcsChars.length}. The yellow path shows how we recovered it.`
                    );
                    highlightCode("trace");
                    renderDpTable();
                    updateCharHighlights();
                    renderBacktrackingPath();
                    return;
                }

                const direction = state.dir[i][j];
                const charA = a[i - 1];

                state.lastTraceI = i;
                state.lastTraceJ = j;

                const pathIndex = state.backtrackingPath.findIndex(cell => 
                    cell[0] === i && cell[1] === j
                );
                if (pathIndex >= 0) {
                    renderBacktrackingPath();
                }

                if (direction === "diag") {
                    state.lcsChars.unshift(charA);
                    setExplanation(
                        `<i class="fas fa-map-marker-alt" style="color: var(--trace);"></i> Cell (${i}, ${j}) has diagonal arrow . This means A[${i}]='${charA}' is part of the LCS! Moving to (${i - 1}, ${j - 1}).`
                    );
                    state.traceI = i - 1;
                    state.traceJ = j - 1;
                } else if (direction === "up") {
                    setExplanation(
                        `<i class="fas fa-map-marker-alt" style="color: var(--trace);"></i> Cell (${i}, ${j}) has upward arrow . Moving to (${i - 1}, ${j}). We skip A[${i}]='${charA}'.`
                    );
                    state.traceI = i - 1;
                } else if (direction === "left") {
                    setExplanation(
                        `<i class="fas fa-map-marker-alt" style="color: var(--trace);"></i> Cell (${i}, ${j}) has left arrow . Moving to (${i}, ${j - 1}).`
                    );
                    state.traceJ = j - 1;
                } else {
                    state.traceI = i - 1;
                    state.traceJ = j;
                }

                setLcsDisplay();
                highlightCode("trace");
                renderDpTable();
                updateCharHighlights();
            }

            function stepOnce() {
                if (state.phase === "idle") {
                    setExplanation("<i class='fas fa-exclamation-triangle'></i> Click 'Initialize' first to start the algorithm!");
                    return;
                }

                if (state.phase === "filling") {
                    stepFilling();
                    return;
                }

                if (state.phase === "trace") {
                    stepTraceback();
                    return;
                }

                if (state.phase === "done") {
                    setExplanation("<i class='fas fa-check-circle'></i> Algorithm complete! Click 'Reset' or change inputs to try again.");
                }
            }

            function startAutoPlay() {
                if (state.playing) return;
                state.playing = true;
                if (state.phase === "idle") {
                    initDp();
                }
                if (state.intervalId) clearInterval(state.intervalId);
                state.intervalId = setInterval(() => {
                    if (state.phase === "done") {
                        stopAutoPlay();
                        return;
                    }
                    stepOnce();
                }, state.speed);
            }

            function stopAutoPlay() {
                state.playing = false;
                if (state.intervalId) {
                    clearInterval(state.intervalId);
                    state.intervalId = null;
                }
            }

            function resetAll() {
                stopAutoPlay();
                state.a = "";
                state.b = "";
                state.n = 0;
                state.m = 0;
                state.dp = [];
                state.dir = [];
                state.phase = "idle";
                state.i = 1;
                state.j = 1;
                state.lastFillI = null;
                state.lastFillJ = null;
                state.traceI = null;
                state.traceJ = null;
                state.lastTraceI = null;
                state.lastTraceJ = null;
                state.currentStep = 0;
                state.totalSteps = 0;
                state.backtrackingPath = [];
                state.rollingDP = null;
                clearLcsDisplay();
                updateStats();
                els.dpTableContainer.innerHTML = "";
                els.charsA.innerHTML = "";
                els.charsB.innerHTML = "";
                setExplanation("<i class='fas fa-info-circle'></i> Enter two sequences and click 'Initialize' to begin. Watch the characters compare step-by-step!");
                highlightCode(null);
                updateCharHighlights();
                renderBacktrackingPath();
            }

            function initializePremiumSlider() {
                const slider = els.speedSlider;
                const thumb = document.getElementById('sliderThumb');
                const fill = document.getElementById('sliderFill');
                const marks = document.getElementById('speedMarks');
                
                if (!slider || !thumb || !fill) return;
                
                function updateSliderUI() {
                    const value = parseInt(slider.value);
                    const min = parseInt(slider.min);
                    const max = parseInt(slider.max);
                    const percentage = ((value - min) / (max - min)) * 100;
                    
                    thumb.style.transition = 'left 0.1s ease, transform 0.15s ease';
                    thumb.style.left = `${percentage}%`;
                    
                    fill.style.width = `${percentage}%`;
                    
                    if (marks) {
                        document.querySelectorAll('.slider-mark').forEach(mark => {
                            const markValue = parseInt(mark.dataset.value);
                            if (Math.abs(value - markValue) <= 20) {
                                mark.classList.add('active');
                            } else {
                                mark.classList.remove('active');
                            }
                        });
                    }
                    
                    state.speed = value;
                    updateSpeedLabel();
                }
                
                updateSliderUI();
                
                slider.addEventListener('input', function(e) {
                    updateSliderUI();
                    
                    thumb.style.animation = 'none';
                    setTimeout(() => {
                        thumb.style.animation = 'thumbPulse 0.4s ease';
                    }, 10);
                    
                    if (state.playing) {
                        stopAutoPlay();
                        startAutoPlay();
                    }
                });
                
                if (marks) {
                    marks.querySelectorAll('.slider-mark').forEach(mark => {
                        mark.addEventListener('click', () => {
                            const value = parseInt(mark.dataset.value);
                            slider.value = value;
                            updateSliderUI();
                            
                            slider.dispatchEvent(new Event('input', { bubbles: true }));
                            
                            mark.style.transform = 'scale(0.95)';
                            setTimeout(() => {
                                mark.style.transform = 'scale(1)';
                            }, 150);
                        });
                    });
                }
                
                let isDragging = false;
                
                thumb.addEventListener('mousedown', startDrag);
                thumb.addEventListener('touchstart', startDrag);
                
                function startDrag(e) {
                    e.preventDefault();
                    isDragging = true;
                    thumb.classList.add('active');
                    
                    const sliderRect = slider.getBoundingClientRect();
                    const sliderWidth = sliderRect.width;
                    
                    function moveHandler(clientX) {
                        if (!isDragging) return;
                        
                        const x = Math.min(Math.max(clientX - sliderRect.left, 0), sliderWidth);
                        const percentage = (x / sliderWidth) * 100;
                        const min = parseInt(slider.min);
                        const max = parseInt(slider.max);
                        const step = parseInt(slider.step);
                        
                        let value = Math.round((percentage / 100) * (max - min)) + min;
                        value = Math.round(value / step) * step;
                        value = Math.max(min, Math.min(max, value));
                        
                        slider.value = value;
                        updateSliderUI();
                        slider.dispatchEvent(new Event('input', { bubbles: true }));
                    }
                    
                    function onMouseMove(e) {
                        moveHandler(e.clientX);
                    }
                    
                    function onTouchMove(e) {
                        if (e.touches.length > 0) {
                            moveHandler(e.touches[0].clientX);
                        }
                    }
                    
                    function stopDrag() {
                        isDragging = false;
                        thumb.classList.remove('active');
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', stopDrag);
                        document.removeEventListener('touchmove', onTouchMove);
                        document.removeEventListener('touchend', stopDrag);
                    }
                    
                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', stopDrag);
                    document.addEventListener('touchmove', onTouchMove);
                    document.addEventListener('touchend', stopDrag);
                }
                
                slider.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                        thumb.style.animation = 'thumbPulse 0.3s ease';
                    }
                });
                
                function handleResize() {
                    updateSliderUI();
                }
                
                window.addEventListener('resize', handleResize);
            }

            function attachEvents() {
                els.initBtn.addEventListener("click", () => {
                    stopAutoPlay();
                    initDp();
                });

                els.stepBtn.addEventListener("click", () => {
                    stopAutoPlay();
                    stepOnce();
                });

                els.playBtn.addEventListener("click", () => {
                    startAutoPlay();
                });

                els.pauseBtn.addEventListener("click", () => {
                    stopAutoPlay();
                });

                els.resetBtn.addEventListener("click", () => {
                    resetAll();
                });

                document.querySelectorAll(".algo-tab").forEach(tab => {
                    tab.addEventListener("click", () => {
                        setAlgorithm(tab.dataset.algo);
                    });
                });

                document.querySelectorAll(".chip[data-preset]").forEach((chip) => {
                    chip.addEventListener("click", () => {
                        const preset = chip.getAttribute("data-preset");
                        if (preset === "classic") {
                            els.seqA.value = "AGGTAB";
                            els.seqB.value = "GXTXAYB";
                        } else if (preset === "match-heavy") {
                            els.seqA.value = "ABCDGH";
                            els.seqB.value = "AEDFHR";
                        } else if (preset === "almost-equal") {
                            els.seqA.value = "ABCDEF";
                            els.seqB.value = "ABDFEF";
                        } else if (preset === "simple") {
                            els.seqA.value = "ABC";
                            els.seqB.value = "AC";
                        }
                        stopAutoPlay();
                        initDp();
                    });
                });

                document.addEventListener('keydown', (e) => {
                    if (e.target.tagName === 'INPUT') return;
                    
                    switch(e.key) {
                        case ' ':
                        case 'Enter':
                            e.preventDefault();
                            stepOnce();
                            break;
                        case 'r':
                        case 'R':
                            if (e.ctrlKey) {
                                e.preventDefault();
                                resetAll();
                            }
                            break;
                        case 'i':
                        case 'I':
                            if (e.ctrlKey) {
                                e.preventDefault();
                                els.initBtn.click();
                            }
                            break;
                        case 'p':
                        case 'P':
                            if (e.ctrlKey) {
                                e.preventDefault();
                                if (state.playing) {
                                    stopAutoPlay();
                                } else {
                                    startAutoPlay();
                                }
                            }
                            break;
                    }
                });
            }

            function initDefaultValues() {
                els.seqA.value = "AGGTAB";
                els.seqB.value = "GXTXAYB";
                state.speed = Number(els.speedSlider.value);
                updateSpeedLabel();
                renderPseudocode();
                initDp();
            }

            function init() {
                cacheElements();
                attachEvents();
                initializePremiumSlider();
                initDefaultValues();
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();

        // Pre-test Script
        (function() {
            const quizData = [
                {
                    id: 1,
                    question: "What is a <i>subsequence</i> of a string?",
                    options: [
                        "A contiguous block of characters",
                        "Characters chosen in order, not necessarily contiguous",
                        "Any permutation of characters",
                        "A prefix of the string"
                    ],
                    correctAnswer: 1,
                    visualization: `
                        <h3>Understanding Subsequence</h3>
                        <p>A <span class="highlight">subsequence</span> is a sequence that can be derived from another sequence by deleting some or no elements <strong>without changing the order</strong> of the remaining elements.</p>
                        
                        <h3>Example</h3>
                        <p>For string <span class="highlight">"ABCD"</span>, some valid subsequences are:</p>
                        <ul style="margin-left: 20px; margin-bottom: 15px;">
                            <li>"A", "B", "C", "D"</li>
                            <li>"AB", "AC", "AD", "BC", "BD", "CD"</li>
                            <li>"ABC", "ABD", "ACD", "BCD"</li>
                            <li>"ABCD"</li>
                        </ul>
                        
                        <h3>Key Differences</h3>
                        <p><strong>Substring:</strong> Must be contiguous (e.g., "BC" from "ABCD")</p>
                        <p><strong>Subsequence:</strong> Does not need to be contiguous (e.g., "AC" from "ABCD")</p>
                    `
                },
                {
                    id: 2,
                    question: "If characters are removed from a string without changing order, the result is a:",
                    options: [
                        "Substring",
                        "Subsequence",
                        "Permutation",
                        "Prefix"
                    ],
                    correctAnswer: 1,
                    visualization: `
                        <h3>Subsequence Definition</h3>
                        <p>When you remove characters from a string <strong>without changing the order</strong> of the remaining characters, you get a <span class="highlight">subsequence</span>.</p>
                        
                        <h3>Example</h3>
                        <p>Original string: <span class="highlight">"COMPUTER"</span></p>
                        <p>Remove characters: Remove 'M', 'U', 'E'</p>
                        <p>Result: <span class="highlight">"COPTR"</span> (This is a subsequence)</p>
                        
                        <h3>Important Notes</h3>
                        <ul style="margin-left: 20px;">
                            <li>You can remove any number of characters (including 0 or all)</li>
                            <li>Order of remaining characters must match original order</li>
                            <li>This is different from substring (which requires contiguity)</li>
                        </ul>
                    `
                },
                {
                    id: 3,
                    question: "In the Rod Cutting problem, what is the main objective?",
                    options: [
                        "Minimize the number of cuts",
                        "Maximize the total profit from cuts",
                        "Use the longest rod pieces",
                        "Minimize rod wastage"
                    ],
                    correctAnswer: 1,
                    visualization: `
                        <h3>Rod Cutting Problem</h3>
                        <p>The main objective is to <span class="highlight">maximize total profit</span> by cutting the rod into pieces and selling them.</p>
                        
                        <h3>Problem Setup</h3>
                        <p>You have a rod of length <span class="highlight">n</span> with prices for different lengths:</p>
                        <ul style="margin-left: 20px;">
                            <li>Length 1: Price 1</li>
                            <li>Length 2: Price 5</li>
                            <li>Length 3: Price 8</li>
                            <li>Length 4: Price 9</li>
                        </ul>
                        
                        <h3>Example</h3>
                        <p>For a rod of length 4:</p>
                        <ul style="margin-left: 20px;">
                            <li>Sell as is: Profit = 9</li>
                            <li>Cut into 2+2: Profit = 5 + 5 = 10</li>
                            <li>Cut into 1+3: Profit = 1 + 8 = 9</li>
                            <li>Cut into 1+1+1+1: Profit = 1 + 1 + 1 + 1 = 4</li>
                        </ul>
                        <p><strong>Optimal:</strong> Cut into two pieces of length 2 for profit 10</p>
                    `
                },
                {
                    id: 4,
                    question: "Which property is common to both LCS and Rod Cutting problems?",
                    options: [
                        "Greedy choice property",
                        "Optimal substructure",
                        "Divide-and-conquer only",
                        "Sorting-based solution"
                    ],
                    correctAnswer: 1,
                    visualization: `
                        <h3>Optimal Substructure</h3>
                        <p>Both LCS and Rod Cutting exhibit <span class="highlight">optimal substructure</span>, which is essential for Dynamic Programming solutions.</p>
                        
                        <h3>What is Optimal Substructure?</h3>
                        <p>A problem has optimal substructure if an optimal solution can be constructed from optimal solutions of its subproblems.</p>
                        
                        <h3>In LCS</h3>
                        <p>The LCS of two strings can be found from:</p>
                        <ul style="margin-left: 20px;">
                            <li>LCS of prefixes (if characters match)</li>
                            <li>Maximum of LCS(string1-1, string2) and LCS(string1, string2-1) (if characters don't match)</li>
                        </ul>
                        
                        <h3>In Rod Cutting</h3>
                        <p>The optimal revenue for rod length n can be found from:</p>
                        <p style="text-align: center; margin: 10px 0;"><span class="highlight">max(price[i] + revenue[n-i])</span> for all i from 1 to n</p>
                        
                        <h3>Why This Matters</h3>
                        <p>Optimal substructure allows us to break down complex problems into simpler subproblems and combine their solutions.</p>
                    `
                },
                {
                    id: 5,
                    question: "Why even use Dynamic Programming (DP) instead of a Greedy Algorithm (GA)?",
                    options: [
                        "GA is slow.",
                        "DP uses constant auxiliary space to solve the problem.",
                        "DP reuses the solved subproblems to solve a bigger problem that includes those subproblems.",
                        "DP always solves a problem in linear time."
                    ],
                    correctAnswer: 2,
                    visualization: `
                        <h3>DP vs Greedy Algorithms</h3>
                        <p>The key advantage of DP is that it <span class="highlight">reuses solved subproblems</span> to avoid redundant computations.</p>
                        
                        <h3>Why Greedy Algorithms Fail</h3>
                        <p>Greedy algorithms make the locally optimal choice at each step, but this doesn't always lead to a globally optimal solution.</p>
                        
                        <h3>Example: Rod Cutting</h3>
                        <p>Prices: [1, 5, 8, 9] for lengths 1-4</p>
                        <p><strong>Greedy approach:</strong> Always cut the most profitable piece first</p>
                        <p>For length 4: Price per unit = [1, 2.5, 2.67, 2.25]</p>
                        <p>Greedy would choose length 3 first (2.67 per unit), then length 1: Total = 8 + 1 = 9</p>
                        <p><strong>But optimal is:</strong> Two pieces of length 2: Total = 5 + 5 = 10</p>
                        
                        <h3>DP Solution</h3>
                        <p>DP solves all subproblems (revenue for lengths 1, 2, 3, 4) and reuses them to find the optimal solution.</p>
                    `
                },
                {
                    id: 6,
                    question: "What happens if two strings share no common characters?",
                    options: [
                        "LCS is undefined",
                        "LCS length is 1",
                        "LCS length is 0",
                        "LCS length equals string length"
                    ],
                    correctAnswer: 2,
                    visualization: `
                        <h3>LCS with No Common Characters</h3>
                        <p>When two strings share <span class="highlight">no common characters</span>, the Longest Common Subsequence has length <span class="highlight">0</span>.</p>
                        
                        <h3>Example</h3>
                        <p>String 1: <span class="highlight">"ABCD"</span></p>
                        <p>String 2: <span class="highlight">"EFGH"</span></p>
                        <p>LCS Length: <span class="highlight">0</span></p>
                        <p>LCS: <span class="highlight">""</span> (empty string)</p>
                        
                        <h3>DP Table</h3>
                        <p>The DP table would be filled with zeros:</p>
                        <div style="background-color: #f1f5f9; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <p style="font-family: monospace; margin: 5px 0;">    E F G H</p>
                            <p style="font-family: monospace; margin: 5px 0;">A [0 0 0 0]</p>
                            <p style="font-family: monospace; margin: 5px 0;">B [0 0 0 0]</p>
                            <p style="font-family: monospace; margin: 5px 0;">C [0 0 0 0]</p>
                            <p style="font-family: monospace; margin: 5px 0;">D [0 0 0 0]</p>
                        </div>
                        
                        <h3>Why 0?</h3>
                        <p>The empty string is always a subsequence of any string, and when there are no matching characters, it's the only common subsequence.</p>
                    `
                },
                {
                    id: 7,
                    question: "In Rod Cutting, why can selling smaller pieces sometimes give more profit than one large piece?",
                    options: [
                        "Prices increase with cuts",
                        "Prices are arbitrary and non-linear",
                        "Cutting reduces cost",
                        "Rod length changes"
                    ],
                    correctAnswer: 1,
                    visualization: `
                        <h3>Non-linear Pricing</h3>
                        <p>In Rod Cutting, prices are <span class="highlight">arbitrary and non-linear</span>, meaning the price per unit length can vary.</p>
                        
                        <h3>Example Scenario</h3>
                        <p>Rod Length: 5 units</p>
                        <p>Prices:</p>
                        <ul style="margin-left: 20px;">
                            <li>Length 1: $1 ($1/unit)</li>
                            <li>Length 2: $5 ($2.5/unit)</li>
                            <li>Length 3: $8 ($2.67/unit)</li>
                            <li>Length 4: $9 ($2.25/unit)</li>
                            <li>Length 5: $10 ($2/unit)</li>
                        </ul>
                        
                        <h3>Analysis</h3>
                        <p><strong>Sell as one piece:</strong> Length 5  $10</p>
                        <p><strong>Sell as smaller pieces:</strong> Length 2 + Length 3  $5 + $8 = $13</p>
                        <p><span class="highlight">Smaller pieces give $3 more profit!</span></p>
                        
                        <h3>Why This Happens</h3>
                        <p>Market prices don't always follow linear patterns. Sometimes:</p>
                        <ul style="margin-left: 20px;">
                            <li>Certain lengths are in higher demand</li>
                            <li>Manufacturing costs vary by size</li>
                            <li>Market preferences create price anomalies</li>
                        </ul>
                    `
                },
                {
                    id: 8,
                    question: "What makes both problems computationally hard without DP?",
                    options: [
                        "Large input size only",
                        "Overlapping subproblems",
                        "Need for sorting",
                        "Exponential number of possible solutions"
                    ],
                    correctAnswer: 3,
                    visualization: `
                        <h3>Exponential Complexity</h3>
                        <p>Both LCS and Rod Cutting have an <span class="highlight">exponential number of possible solutions</span> to consider without DP optimization.</p>
                        
                        <h3>LCS Complexity</h3>
                        <p>For two strings of length n and m:</p>
                        <ul style="margin-left: 20px;">
                            <li>Naive recursive solution: O(2<sup>n+m</sup>)</li>
                            <li>Number of subsequences of a string of length n: 2<sup>n</sup></li>
                            <li>For n=20: 1,048,576 possible subsequences</li>
                            <li>For n=30: 1,073,741,824 possible subsequences</li>
                        </ul>
                        
                        <h3>Rod Cutting Complexity</h3>
                        <p>For a rod of length n:</p>
                        <ul style="margin-left: 20px;">
                            <li>Number of ways to cut: 2<sup>n-1</sup></li>
                            <li>For n=10: 512 possibilities</li>
                            <li>For n=20: 524,288 possibilities</li>
                            <li>For n=30: 536,870,912 possibilities</li>
                        </ul>
                        
                        <h3>DP to the Rescue</h3>
                        <p>Dynamic Programming reduces this to polynomial time:</p>
                        <ul style="margin-left: 20px;">
                            <li>LCS: O(n*m) time and space</li>
                            <li>Rod Cutting: O(n) time, O(n) space</li>
                        </ul>
                    `
                },
                {
                    id: 9,
                    question: "What is the time complexity of the naive recursive solution for the LCS problem?",
                    options: [
                        "O(n)",
                        "O(n)",
                        "O(2)",
                        "O(n log n)"
                    ],
                    correctAnswer: 2,
                    visualization: `
                        <h3>Exponential Time Complexity</h3>
                        <p>The naive recursive solution for LCS has <span class="highlight">exponential time complexity</span>: O(2<sup>n+m</sup>) in the worst case.</p>
                        
                        <h3>Recursive Tree</h3>
                        <p>For strings "ABCD" and "WXYZ":</p>
                        <div style="background-color: #f1f5f9; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <p>Each call makes 2 recursive calls when characters don't match:</p>
                            <p style="font-family: monospace; margin: 5px 0;">LCS("ABCD", "WXYZ")</p>
                            <p style="font-family: monospace; margin: 5px 0;"> LCS("ABC", "WXYZ")</p>
                            <p style="font-family: monospace; margin: 5px 0;">    LCS("AB", "WXYZ")</p>
                            <p style="font-family: monospace; margin: 5px 0;">    LCS("ABC", "WXY")</p>
                            <p style="font-family: monospace; margin: 5px 0;"> LCS("ABCD", "WXY")</p>
                            <p style="font-family: monospace; margin: 5px 0;">     LCS("ABC", "WXY")</p>
                            <p style="font-family: monospace; margin: 5px 0;">     LCS("ABCD", "WX")</p>
                        </div>
                        
                        <h3>Why Exponential?</h3>
                        <p>Each character comparison can lead to two recursive calls, creating a binary tree of calls with depth n+m.</p>
                        <p>Total calls  2<sup>n+m</sup></p>
                        
                        <h3>DP Improvement</h3>
                        <p>Dynamic Programming reduces this to O(n*m) by storing results of subproblems.</p>
                    `
                },
                {
                    id: 10,
                    question: "In Rod Cutting, the DP table entry dp[i] represents:",
                    options: [
                        "Number of cuts made",
                        "Maximum revenue for a rod of given length",
                        "Price of rod piece i",
                        "Length of rod remaining"
                    ],
                    correctAnswer: 1,
                    visualization: `
                        <h3>DP Table in Rod Cutting</h3>
                        <p>In the Rod Cutting DP solution, <span class="highlight">dp[i]</span> represents the <strong>maximum revenue</strong> obtainable for a rod of length <span class="highlight">i</span>.</p>
                        
                        <h3>Example DP Table</h3>
                        <p>Prices: [1, 5, 8, 9] for lengths 1-4</p>
                        <div style="background-color: #f1f5f9; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <p style="font-family: monospace; margin: 5px 0;">dp[0] = 0 (no rod, no revenue)</p>
                            <p style="font-family: monospace; margin: 5px 0;">dp[1] = max(price[1]) = 1</p>
                            <p style="font-family: monospace; margin: 5px 0;">dp[2] = max(price[2], price[1]+dp[1]) = max(5, 1+1) = 5</p>
                            <p style="font-family: monospace; margin: 5px 0;">dp[3] = max(price[3], price[1]+dp[2], price[2]+dp[1]) = max(8, 1+5, 5+1) = 8</p>
                            <p style="font-family: monospace; margin: 5px 0;">dp[4] = max(price[4], price[1]+dp[3], price[2]+dp[2], price[3]+dp[1])</p>
                            <p style="font-family: monospace; margin: 5px 0;">      = max(9, 1+8, 5+5, 8+1) = max(9, 9, 10, 9) = 10</p>
                        </div>
                        
                        <h3>Key Insight</h3>
                        <p>dp[i] stores the optimal solution for subproblem of size i, which can be used to solve larger problems.</p>
                        
                        <h3>Recurrence Relation</h3>
                        <p style="text-align: center; margin: 15px 0;"><span class="highlight">dp[n] = max(price[i] + dp[n-i])</span> for all i from 1 to n</p>
                    `
                }
            ];
            
            const state = {
                currentQuestion: 0,
                userAnswers: new Array(quizData.length).fill(null),
                scores: {
                    correct: 0,
                    incorrect: 0
                },
                submitted: false
            };
            
            function loadQuestion(index) {
                const question = quizData[index];
                
                document.getElementById('pretest-question-number').textContent = `Question ${index + 1}`;
                document.getElementById('pretest-question-text').innerHTML = question.question;
                document.getElementById('pretest-current-question').textContent = index + 1;
                
                updateProgress();
                
                document.getElementById('pretest-options-container').innerHTML = '';
                const feedbackArea = document.getElementById('pretest-feedback-area');
                feedbackArea.className = 'feedback-area';
                feedbackArea.style.display = 'none';
                
                document.getElementById('pretest-visual-subtitle').textContent = 'Select an option to see detailed explanation';
                document.getElementById('pretest-visual-content').innerHTML = `
                    <div class="default-visualization">
                        <i class="fas fa-mouse-pointer"></i>
                        <h3>Select an Answer</h3>
                        <p>Choose one of the options to see detailed explanation and visualization here.</p>
                    </div>
                `;
                
                const optionLetters = ['A', 'B', 'C', 'D'];
                question.options.forEach((optionText, i) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    optionDiv.dataset.index = i;
                    
                    const optionLetter = document.createElement('span');
                    optionLetter.className = 'option-letter';
                    optionLetter.textContent = optionLetters[i];
                    
                    const optionTextSpan = document.createElement('span');
                    optionTextSpan.className = 'option-text';
                    optionTextSpan.textContent = optionText;
                    
                    optionDiv.appendChild(optionLetter);
                    optionDiv.appendChild(optionTextSpan);
                    
                    if (state.userAnswers[index] === i) {
                        optionDiv.classList.add('selected');
                        if (state.userAnswers[index] === question.correctAnswer) {
                            optionDiv.classList.add('correct');
                        } else {
                            optionDiv.classList.add('incorrect');
                        }
                    }
                    
                    optionDiv.addEventListener('click', () => selectOption(index, i));
                    document.getElementById('pretest-options-container').appendChild(optionDiv);
                });
                
                document.getElementById('pretest-prev-btn').disabled = index === 0;
                document.getElementById('pretest-next-btn').disabled = state.userAnswers[index] === null;
                
                if (index === quizData.length - 1) {
                    document.getElementById('pretest-next-btn').innerHTML = 'Submit Test <i class="fas fa-paper-plane"></i>';
                } else {
                    document.getElementById('pretest-next-btn').innerHTML = 'Next Question <i class="fas fa-arrow-right"></i>';
                }
                
                if (state.userAnswers[index] !== null) {
                    showFeedback(index);
                }
            }
            
            function selectOption(questionIndex, optionIndex) {
                if (state.submitted) return;
                
                const question = quizData[questionIndex];
                state.userAnswers[questionIndex] = optionIndex;
                
                updateScore();
                
                document.getElementById('pretest-next-btn').disabled = false;
                
                const options = document.querySelectorAll('#pretest-options-container .option');
                options.forEach((opt, i) => {
                    opt.classList.remove('selected', 'correct', 'incorrect');
                    if (i === optionIndex) {
                        opt.classList.add('selected');
                        if (i === question.correctAnswer) {
                            opt.classList.add('correct');
                        } else {
                            opt.classList.add('incorrect');
                        }
                    } else if (i === question.correctAnswer) {
                        opt.classList.add('correct');
                    }
                });
                
                showFeedback(questionIndex);
                updateVisualization(questionIndex, optionIndex);
            }
            
            function showFeedback(questionIndex) {
                const question = quizData[questionIndex];
                const userAnswer = state.userAnswers[questionIndex];
                
                if (userAnswer === null) return;
                
                const isCorrect = userAnswer === question.correctAnswer;
                
                const feedbackArea = document.getElementById('pretest-feedback-area');
                const feedbackText = document.getElementById('pretest-feedback-text');
                const feedbackExplanation = document.getElementById('pretest-feedback-explanation');
                
                feedbackArea.className = `feedback-area show ${isCorrect ? 'correct' : 'incorrect'}`;
                feedbackText.className = `feedback-text ${isCorrect ? 'correct' : 'incorrect'}`;
                
                if (isCorrect) {
                    feedbackText.innerHTML = '<i class="fas fa-check-circle"></i> Correct!';
                    feedbackExplanation.textContent = 'You selected the right answer.';
                } else {
                    feedbackText.innerHTML = '<i class="fas fa-times-circle"></i> Incorrect';
                    feedbackExplanation.textContent = `The correct answer is: ${String.fromCharCode(65 + question.correctAnswer)}. ${question.options[question.correctAnswer]}`;
                }
            }
            
            function updateVisualization(questionIndex, optionIndex) {
                const question = quizData[questionIndex];
                const isCorrect = optionIndex === question.correctAnswer;
                
                const visualSubtitle = document.getElementById('pretest-visual-subtitle');
                const visualContent = document.getElementById('pretest-visual-content');
                
                visualSubtitle.innerHTML = isCorrect 
                    ? '<span style="color: #10b981;"><i class="fas fa-check-circle"></i> Correct Answer Selected</span>'
                    : '<span style="color: #ef4444;"><i class="fas fa-times-circle"></i> Incorrect Answer Selected</span>';
                
                visualContent.innerHTML = question.visualization;
            }
            
            function updateProgress() {
                const progress = ((state.currentQuestion + 1) / quizData.length) * 100;
                document.getElementById('pretest-progress-fill').style.width = `${progress}%`;
                document.getElementById('pretest-correct-count').textContent = state.scores.correct;
            }
            
            function updateScore() {
                state.scores.correct = 0;
                state.scores.incorrect = 0;
                
                state.userAnswers.forEach((answer, index) => {
                    if (answer !== null) {
                        if (answer === quizData[index].correctAnswer) {
                            state.scores.correct++;
                        } else {
                            state.scores.incorrect++;
                        }
                    }
                });
                
                document.getElementById('pretest-correct-count').textContent = state.scores.correct;
            }
            
            function showResults() {
                state.submitted = true;
                updateScore();
                
                const score = state.scores.correct;
                const percentage = (score / quizData.length) * 100;
                
                document.getElementById('pretest-final-score').textContent = `${score}/${quizData.length}`;
                
                const proceedBtn = document.getElementById('pretest-proceed-btn');
                const completionMessage = document.getElementById('pretest-completion-message');
                
                if (score >= 4) {
                    proceedBtn.style.display = 'flex';
                    completionMessage.textContent = "You are now ready to proceed to the Dynamic Programming Lab Simulation.";
                } else {
                    proceedBtn.style.display = 'none';
                    completionMessage.textContent = "You need to score at least 4/10 to proceed to the lab simulation.";
                }
                
                const scoreMessage = document.getElementById('pretest-score-message');
                const feedbackFinal = document.getElementById('pretest-final-feedback');
                
                if (percentage >= 80) {
                    scoreMessage.textContent = "Excellent! You have a strong foundation in DP concepts.";
                    feedbackFinal.textContent = "Ready for the lab simulation!";
                    feedbackFinal.style.color = "#10b981";
                } else if (percentage >= 60) {
                    scoreMessage.textContent = "Good job! You understand the basics but may need some review.";
                    feedbackFinal.textContent = score >= 4 ? "Proceed to the lab simulation." : "Review and try again.";
                    feedbackFinal.style.color = "#f59e0b";
                } else {
                    scoreMessage.textContent = "You might want to review DP concepts before the lab simulation.";
                    feedbackFinal.textContent = "Consider reviewing the fundamentals first.";
                    feedbackFinal.style.color = "#ef4444";
                }
                
                document.getElementById('pretest-results-overlay').classList.add('show');
            }
            
            function resetQuiz() {
                state.currentQuestion = 0;
                state.userAnswers.fill(null);
                state.scores = { correct: 0, incorrect: 0 };
                state.submitted = false;
                
                document.getElementById('pretest-results-overlay').classList.remove('show');
                loadQuestion(0);
                updateScore();
            }
            
            document.getElementById('pretest-total-questions').textContent = quizData.length;
            loadQuestion(state.currentQuestion);
            
            document.getElementById('pretest-prev-btn').addEventListener('click', () => {
                if (state.currentQuestion > 0) {
                    state.currentQuestion--;
                    loadQuestion(state.currentQuestion);
                }
            });
            
            document.getElementById('pretest-next-btn').addEventListener('click', () => {
                if (state.userAnswers[state.currentQuestion] === null) {
                    alert("Please select an answer before proceeding to the next question.");
                    return;
                }
                
                if (state.currentQuestion < quizData.length - 1) {
                    state.currentQuestion++;
                    loadQuestion(state.currentQuestion);
                } else {
                    showResults();
                }
            });
            
            document.getElementById('pretest-retake-btn').addEventListener('click', resetQuiz);
            document.getElementById('pretest-proceed-btn').addEventListener('click', () => {
                document.querySelector('[data-mode="main"]').click();
            });
        })();

        // Post-test Script
        (function() {
            const quizData = [
                {
                    id: 1,
                    question: "Why do we add <code>+1</code> in LCS DP when characters match?",
                    options: [
                        "To count both characters",
                        "To extend an existing optimal subsequence",
                        "To move diagonally",
                        "To increase table size"
                    ],
                    correctAnswer: 1,
                    visualization: `
                        <h3>Why +1 in LCS DP?</h3>
                        <p>We add <span class="highlight">+1</span> when characters match to extend the optimal subsequence found so far.</p>
                        
                        <h3>DP Table Logic</h3>
                        <p>When characters at position (i, j) match:</p>
                        <p style="text-align: center; margin: 10px 0;"><span class="highlight">dp[i][j] = dp[i-1][j-1] + 1</span></p>
                        
                        <h3>Example</h3>
                        <p>Strings: "ABCD" and "ACDF"</p>
                        <table class="dp-table">
                            <tr>
                                <th></th><th>A</th><th>C</th><th>D</th><th>F</th>
                            </tr>
                            <tr>
                                <th>A</th><td class="match-cell">1</td><td>1</td><td>1</td><td>1</td>
                            </tr>
                            <tr>
                                <th>B</th><td>1</td><td>1</td><td>1</td><td>1</td>
                            </tr>
                            <tr>
                                <th>C</th><td>1</td><td class="match-cell">2</td><td>2</td><td>2</td>
                            </tr>
                            <tr>
                                <th>D</th><td>1</td><td>2</td><td class="match-cell">3</td><td>3</td>
                            </tr>
                        </table>
                        
                        <h3>Key Insight</h3>
                        <p>The matching character extends the LCS found for the prefixes (i-1, j-1) by 1, creating a longer common subsequence.</p>
                    `
                },
                {
                    id: 2,
                    question: "When LCS characters don't match, why do we take <code>max(dp[i-1][j], dp[i][j-1])</code>?",
                    options: [
                        "To skip one character from either string",
                        "To ensure lexicographically smallest LCS",
                        "To reduce space",
                        "To force recursion"
                    ],
                    correctAnswer: 0,
                    visualization: `
                        <h3>Handling Non-matching Characters</h3>
                        <p>When characters don't match, we take the maximum of two possibilities:</p>
                        
                        <h3>The Two Cases</h3>
                        <p><strong>Case 1:</strong> Skip character from first string  dp[i-1][j]</p>
                        <p><strong>Case 2:</strong> Skip character from second string  dp[i][j-1]</p>
                        <p style="text-align: center; margin: 15px 0;"><span class="highlight">dp[i][j] = max(dp[i-1][j], dp[i][j-1])</span></p>
                        
                        <h3>Example</h3>
                        <p>Comparing 'A' from "ABCD" with 'B' from "ABCE":</p>
                        <ul style="margin-left: 20px;">
                            <li>Option 1: Skip 'A', compare "" with "ABCE"  0</li>
                            <li>Option 2: Skip 'B', compare "A" with "ACE"  1</li>
                            <li>Maximum is 1</li>
                        </ul>
                        
                        <h3>Why This Works</h3>
                        <p>We're exploring both possibilities of which character to skip, ensuring we don't miss a longer subsequence.</p>
                    `
                },
                {
                    id: 3,
                    question: "What does the DP table entry <code>dp[i]</code> represent in Rod Cutting?",
                    options: [
                        "Number of cuts",
                        "Maximum revenue for a rod of length i",
                        "Price of rod piece i",
                        "Length of rod remaining"
                    ],
                    correctAnswer: 1,
                    visualization: `
                        <h3>Rod Cutting DP Table</h3>
                        <p><span class="highlight">dp[i]</span> stores the <strong>maximum revenue</strong> achievable for a rod of length <span class="highlight">i</span>.</p>
                        
                        <h3>Example</h3>
                        <p>Prices: [0, 1, 5, 8, 9] for lengths 0-4</p>
                        <table class="dp-table">
                            <tr>
                                <th>Length (i)</th><th>dp[i] (Max Revenue)</th><th>How calculated</th>
                            </tr>
                            <tr>
                                <td>0</td><td>0</td><td>Base case</td>
                            </tr>
                            <tr>
                                <td>1</td><td>1</td><td>max(price[1]) = 1</td>
                            </tr>
                            <tr>
                                <td>2</td><td>5</td><td>max(price[2], price[1]+dp[1]) = max(5, 1+1) = 5</td>
                            </tr>
                            <tr>
                                <td>3</td><td>8</td><td>max(price[3], price[1]+dp[2], price[2]+dp[1]) = max(8, 1+5, 5+1) = 8</td>
                            </tr>
                            <tr>
                                <td>4</td><td>10</td><td>max(price[4], price[1]+dp[3], price[2]+dp[2], price[3]+dp[1]) = max(9, 1+8, 5+5, 8+1) = 10</td>
                            </tr>
                        </table>
                        
                        <h3>Recurrence Relation</h3>
                        <p style="text-align: center; margin: 15px 0;"><span class="highlight">dp[n] = max(price[i] + dp[n-i])</span> for all i from 1 to n</p>
                    `
                },
                {
                    id: 4,
                    question: "Can LCS problem be performed in less than O(n) space and still be in a state from which the actual LCS can be retrieved?",
                    options: [
                        "Yes, through rolling arrays",
                        "Yes, through Hirschberg's algorithm",
                        "No, because there are 2 strings and at least a matrix is required to perform DP",
                        "No, because backtracking requires a matrix to cover all the possible combinations"
                    ],
                    correctAnswer: 1,
                    visualization: `
                        <h3>Space Optimization for LCS</h3>
                        <p><span class="highlight">Hirschberg's algorithm</span> can solve LCS in O(n*m) time and O(min(n,m)) space while still recovering the actual LCS.</p>
                        
                        <h3>How It Works</h3>
                        <p>Hirschberg's algorithm uses a divide-and-conquer approach:</p>
                        <ol style="margin-left: 20px; margin-bottom: 15px;">
                            <li>Find the midpoint of the first string</li>
                            <li>Compute LCS lengths from both ends</li>
                            <li>Find the optimal split point</li>
                            <li>Recursively solve two subproblems</li>
                        </ol>
                        
                        <h3>Space Comparison</h3>
                        <table class="dp-table">
                            <tr>
                                <th>Algorithm</th><th>Time</th><th>Space</th><th>Can recover LCS?</th>
                            </tr>
                            <tr>
                                <td>Standard DP</td><td>O(n*m)</td><td>O(n*m)</td><td>Yes</td>
                            </tr>
                            <tr>
                                <td>Rolling Arrays</td><td>O(n*m)</td><td>O(min(n,m))</td><td>No</td>
                            </tr>
                            <tr>
                                <td><strong>Hirschberg's</strong></td><td>O(n*m)</td><td>O(min(n,m))</td><td><strong>Yes</strong></td>
                            </tr>
                        </table>
                        
                        <h3>Why This Matters</h3>
                        <p>For very large strings (millions of characters), O(n*m) space becomes impractical, making Hirschberg's algorithm essential.</p>
                    `
                },
                {
                    id: 5,
                    question: "Can LCS have multiple optimal solutions of the same length?",
                    options: [
                        "No",
                        "Yes",
                        "Only for equal strings",
                        "Only for small inputs"
                    ],
                    correctAnswer: 1,
                    visualization: `
                        <h3>Multiple Optimal LCS Solutions</h3>
                        <p><span class="highlight">Yes</span>, LCS can have multiple optimal solutions of the same maximum length.</p>
                        
                        <h3>Example</h3>
                        <p>String 1: <span class="highlight">"ABCBDAB"</span></p>
                        <p>String 2: <span class="highlight">"BDCABA"</span></p>
                        <p>LCS Length: <span class="highlight">4</span></p>
                        <p>Possible LCS of length 4:</p>
                        <ul style="margin-left: 20px;">
                            <li>"BCAB"</li>
                            <li>"BCBA"</li>
                            <li>"BDAB"</li>
                        </ul>
                        
                        <h3>DP Table Shows Multiple Paths</h3>
                        <p>When there are equal values in dp[i-1][j] and dp[i][j-1], it indicates multiple ways to achieve the same LCS length.</p>
                        
                        <table class="dp-table" style="max-width: 300px;">
                            <tr>
                                <th></th><th>B</th><th>D</th><th>C</th><th>A</th><th>B</th><th>A</th>
                            </tr>
                            <tr>
                                <th>A</th><td>0</td><td>0</td><td>0</td><td class="match-cell">1</td><td>1</td><td>1</td>
                            </tr>
                            <tr>
                                <th>B</th><td class="match-cell">1</td><td>1</td><td>1</td><td>1</td><td class="match-cell">2</td><td>2</td>
                            </tr>
                            <tr>
                                <th>C</th><td>1</td><td>1</td><td class="match-cell">2</td><td>2</td><td>2</td><td>2</td>
                            </tr>
                        </table>
                        
                        <h3>Backtracking for All Solutions</h3>
                        <p>To find all LCS, you need to explore all paths when there are ties in the DP table.</p>
                    `
                },
                {
                    id: 6,
                    question: "Why does Rod Cutting consider all possible first cuts?",
                    options: [
                        "To reduce memory usage",
                        "Because the optimal solution may start with any cut length",
                        "To ensure greedy choice",
                        "To avoid recursion"
                    ],
                    correctAnswer: 1,
                    visualization: `
                        <h3>Considering All First Cuts</h3>
                        <p>Rod Cutting must consider all possible first cuts because <span class="highlight">the optimal solution could start with any cut length</span>.</p>
                        
                        <h3>Why Not Greedy?</h3>
                        <p>A greedy approach (always cut the most profitable piece first) doesn't work because:</p>
                        <ul style="margin-left: 20px;">
                            <li>Prices are non-linear</li>
                            <li>Optimal combination might use less profitable pieces</li>
                            <li>Interaction between pieces affects total revenue</li>
                        </ul>
                        
                        <h3>Example</h3>
                        <p>Rod length: 5, Prices: [1, 5, 8, 9, 10]</p>
                        <p>Considering all first cuts:</p>
                        <table class="dp-table">
                            <tr>
                                <th>First Cut</th><th>Remaining</th><th>Revenue</th><th>Total</th>
                            </tr>
                            <tr>
                                <td>1</td><td>4</td><td>1 + dp[4] = 1 + 10 = 11</td><td>11</td>
                            </tr>
                            <tr>
                                <td>2</td><td>3</td><td>5 + dp[3] = 5 + 8 = 13</td><td>13</td>
                            </tr>
                            <tr>
                                <td>3</td><td>2</td><td>8 + dp[2] = 8 + 5 = 13</td><td>13</td>
                            </tr>
                            <tr>
                                <td>4</td><td>1</td><td>9 + dp[1] = 9 + 1 = 10</td><td>10</td>
                            </tr>
                            <tr>
                                <td>5</td><td>0</td><td>10 + dp[0] = 10 + 0 = 10</td><td>10</td>
                            </tr>
                        </table>
                        <p><strong>Optimal:</strong> First cut of 2 or 3 gives revenue 13</p>
                    `
                },
                {
                    id: 7,
                    question: "You are given two strings X = 'ABCBDAB', Y = 'BDCABA'. You are also given a rod of length 7, with prices: Length 1=1, 2=5, 3=8, 4=9, 5=10, 6=17, 7=17. Which statement is correct?",
                    options: [
                        "The length of the LCS of X and Y is 4, and the optimal rod-cutting solution does not cut the rod at all.",
                        "The length of the LCS of X and Y is 3, and the optimal rod-cutting solution makes exactly one cut.",
                        "The LCS length is 4, and the optimal rod-cutting solution uses exactly one cut.",
                        "The LCS length is 5, and the optimal rod-cutting solution gives a maximum revenue of 17 using one cut."
                    ],
                    correctAnswer: 2,
                    visualization: `
                        <h3>Two Problems Analysis</h3>
                        
                        <h3>Part 1: LCS of X and Y</h3>
                        <p>X = "ABCBDAB", Y = "BDCABA"</p>
                        <p>Common subsequences include: "BCBA", "BDAB", "BCAB" (all length 4)</p>
                        <p><strong>LCS Length = 4</strong></p>
                        
                        <h3>Part 2: Rod Cutting</h3>
                        <p>Length 7, Prices: [1, 5, 8, 9, 10, 17, 17]</p>
                        <p>Calculate optimal revenue:</p>
                        <ul style="margin-left: 20px;">
                            <li>dp[1] = 1</li>
                            <li>dp[2] = max(5, 1+1) = 5</li>
                            <li>dp[3] = max(8, 1+5, 5+1) = 8</li>
                            <li>dp[4] = max(9, 1+8, 5+5, 8+1) = 10</li>
                            <li>dp[5] = max(10, 1+10, 5+8, 8+5, 9+1) = 13</li>
                            <li>dp[6] = max(17, 1+13, 5+10, 8+8, 9+5, 10+1) = 17</li>
                            <li>dp[7] = max(17, 1+17, 5+13, 8+10, 9+8, 10+5, 17+1) = 18</li>
                        </ul>
                        <p><strong>Optimal revenue = 18</strong> (cut into 6+1 or 1+6)</p>
                        <p>Uses exactly one cut (2 pieces total)</p>
                        
                        <h3>Conclusion</h3>
                        <p>LCS length = 4, Rod cutting uses 1 cut for optimal solution.</p>
                    `
                },
                {
                    id: 8,
                    question: "What happens when two choices give the same optimal DP value?",
                    options: [
                        "The algorithm fails",
                        "Multiple optimal solutions exist",
                        "DP table resets",
                        "Greedy solution is chosen"
                    ],
                    correctAnswer: 1,
                    visualization: `
                        <h3>Multiple Optimal Solutions</h3>
                        <p>When two choices give the same optimal DP value, it indicates that <span class="highlight">multiple optimal solutions exist</span>.</p>
                        
                        <h3>Example in LCS</h3>
                        <p>When dp[i-1][j] == dp[i][j-1], there are two equally good ways to proceed:</p>
                        <ul style="margin-left: 20px;">
                            <li>Skip character from first string</li>
                            <li>Skip character from second string</li>
                        </ul>
                        <p>Both lead to LCS of the same length, but potentially different subsequences.</p>
                        
                        <h3>Example in Rod Cutting</h3>
                        <p>For rod length 5 with prices [1, 5, 8, 9, 10]:</p>
                        <p>dp[5] = 13 could be achieved by:</p>
                        <ul style="margin-left: 20px;">
                            <li>Cut 2 + 3: 5 + 8 = 13</li>
                            <li>Cut 3 + 2: 8 + 5 = 13</li>
                        </ul>
                        
                        <h3>DP Table Shows Ties</h3>
                        <p>In the DP table, equal values at decision points indicate branching paths to optimal solutions.</p>
                        
                        <table class="dp-table" style="max-width: 250px;">
                            <tr>
                                <th></th><th>A</th><th>B</th><th>C</th>
                            </tr>
                            <tr>
                                <th>A</th><td>1</td><td>1</td><td>1</td>
                            </tr>
                            <tr>
                                <th>B</th><td>1</td><td>2</td><td>2</td>
                            </tr>
                            <tr>
                                <th>C</th><td>1</td><td>2</td><td>3</td>
                            </tr>
                        </table>
                        <p>At dp[2][3], value 2 could come from left or above, indicating multiple paths.</p>
                    `
                },
                {
                    id: 9,
                    question: "Why is recursion alone inefficient for these problems?",
                    options: [
                        "Stack overflow",
                        "Recomputes identical subproblems",
                        "Cannot handle strings",
                        "Cannot maximize profit"
                    ],
                    correctAnswer: 1,
                    visualization: `
                        <h3>The Problem with Pure Recursion</h3>
                        <p>Pure recursion is inefficient because it <span class="highlight">recomputes identical subproblems</span> multiple times.</p>
                        
                        <h3>Recursive Tree for LCS</h3>
                        <p>For strings of length n and m, naive recursion has time complexity O(2<sup>n+m</sup>).</p>
                        
                        <div style="background-color: #f1f5f9; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <p>LCS("ABC", "XYZ") calls:</p>
                            <p style="font-family: monospace; margin: 5px 0;">LCS("ABC", "XYZ")</p>
                            <p style="font-family: monospace; margin: 5px 0;"> LCS("AB", "XYZ")</p>
                            <p style="font-family: monospace; margin: 5px 0;">    LCS("A", "XYZ")  Computed multiple times!</p>
                            <p style="font-family: monospace; margin: 5px 0;">    LCS("AB", "XY")</p>
                            <p style="font-family: monospace; margin: 5px 0;"> LCS("ABC", "XY")</p>
                            <p style="font-family: monospace; margin: 5px 0;">     LCS("AB", "XY")  Duplicate computation!</p>
                            <p style="font-family: monospace; margin: 5px 0;">     LCS("ABC", "X")</p>
                        </div>
                        
                        <h3>DP Solution</h3>
                        <p>Dynamic Programming stores results in a table:</p>
                        <table class="dp-table" style="max-width: 200px;">
                            <tr>
                                <th></th><th>X</th><th>Y</th><th>Z</th>
                            </tr>
                            <tr>
                                <th>A</th><td>0</td><td>0</td><td>0</td>
                            </tr>
                            <tr>
                                <th>B</th><td>0</td><td>0</td><td>0</td>
                            </tr>
                            <tr>
                                <th>C</th><td>0</td><td>0</td><td>0</td>
                            </tr>
                        </table>
                        <p>Each subproblem computed once  O(n*m) time</p>
                    `
                },
                {
                    id: 10,
                    question: "For very large inputs, what becomes the biggest limitation in standard DP?",
                    options: [
                        "Syntax",
                        "CPU speed",
                        "Memory usage",
                        "Input reading"
                    ],
                    correctAnswer: 2,
                    visualization: `
                        <h3>Memory Limitation in DP</h3>
                        <p>For very large inputs, <span class="highlight">memory usage</span> becomes the primary limitation in standard DP implementations.</p>
                        
                        <h3>Space Complexity Examples</h3>
                        <table class="dp-table">
                            <tr>
                                <th>Problem</th><th>Space Complexity</th><th>Memory for n=10,000</th>
                            </tr>
                            <tr>
                                <td>LCS Standard DP</td><td>O(n*m)</td><td>100M cells  4 bytes = 400MB</td>
                            </tr>
                            <tr>
                                <td>Rod Cutting DP</td><td>O(n)</td><td>10K cells  4 bytes = 40KB</td>
                            </tr>
                            <tr>
                                <td>Matrix Chain Multiplication</td><td>O(n)</td><td>100M cells  4 bytes = 400MB</td>
                            </tr>
                        </table>
                        
                        <h3>Why Memory Matters</h3>
                        <ul style="margin-left: 20px;">
                            <li>DP tables grow quadratically with input size</li>
                            <li>Cache misses increase with large tables</li>
                            <li>Memory bandwidth becomes bottleneck</li>
                            <li>Can exceed available RAM for large problems</li>
                        </ul>
                        
                        <h3>Solutions</h3>
                        <p>To handle large inputs:</p>
                        <ol style="margin-left: 20px;">
                            <li>Use space-optimized versions (rolling arrays)</li>
                            <li>Implement memory-efficient algorithms (Hirschberg's for LCS)</li>
                            <li>Use disk-based storage for massive tables</li>
                            <li>Apply approximation algorithms</li>
                        </ol>
                    `
                }
            ];
            
            const state = {
                currentQuestion: 0,
                userAnswers: new Array(quizData.length).fill(null),
                scores: {
                    correct: 0,
                    incorrect: 0
                },
                submitted: false
            };
            
            function loadQuestion(index) {
                const question = quizData[index];
                
                document.getElementById('posttest-question-number').textContent = `Question ${index + 1}`;
                document.getElementById('posttest-question-text').innerHTML = question.question;
                document.getElementById('posttest-current-question').textContent = index + 1;
                
                updateProgress();
                
                document.getElementById('posttest-options-container').innerHTML = '';
                const feedbackArea = document.getElementById('posttest-feedback-area');
                feedbackArea.className = 'feedback-area';
                feedbackArea.style.display = 'none';
                
                document.getElementById('posttest-visual-subtitle').textContent = 'Select an option to see detailed explanation';
                document.getElementById('posttest-visual-content').innerHTML = `
                    <div class="default-visualization">
                        <i class="fas fa-mouse-pointer"></i>
                        <h3>Select an Answer</h3>
                        <p>Choose one of the options to see detailed explanation and visualization here.</p>
                    </div>
                `;
                
                const optionLetters = ['A', 'B', 'C', 'D'];
                question.options.forEach((optionText, i) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    optionDiv.dataset.index = i;
                    
                    const optionLetter = document.createElement('span');
                    optionLetter.className = 'option-letter';
                    optionLetter.textContent = optionLetters[i];
                    
                    const optionTextSpan = document.createElement('span');
                    optionTextSpan.className = 'option-text';
                    optionTextSpan.textContent = optionText;
                    
                    optionDiv.appendChild(optionLetter);
                    optionDiv.appendChild(optionTextSpan);
                    
                    if (state.userAnswers[index] === i) {
                        optionDiv.classList.add('selected');
                        if (state.userAnswers[index] === question.correctAnswer) {
                            optionDiv.classList.add('correct');
                        } else {
                            optionDiv.classList.add('incorrect');
                        }
                    }
                    
                    optionDiv.addEventListener('click', () => selectOption(index, i));
                    document.getElementById('posttest-options-container').appendChild(optionDiv);
                });
                
                document.getElementById('posttest-prev-btn').disabled = index === 0;
                document.getElementById('posttest-next-btn').disabled = state.userAnswers[index] === null;
                
                if (index === quizData.length - 1) {
                    document.getElementById('posttest-next-btn').innerHTML = 'Submit Test <i class="fas fa-paper-plane"></i>';
                } else {
                    document.getElementById('posttest-next-btn').innerHTML = 'Next Question <i class="fas fa-arrow-right"></i>';
                }
                
                if (state.userAnswers[index] !== null) {
                    showFeedback(index);
                }
            }
            
            function selectOption(questionIndex, optionIndex) {
                if (state.submitted) return;
                
                const question = quizData[questionIndex];
                state.userAnswers[questionIndex] = optionIndex;
                
                updateScore();
                
                document.getElementById('posttest-next-btn').disabled = false;
                
                const options = document.querySelectorAll('#posttest-options-container .option');
                options.forEach((opt, i) => {
                    opt.classList.remove('selected', 'correct', 'incorrect');
                    if (i === optionIndex) {
                        opt.classList.add('selected');
                        if (i === question.correctAnswer) {
                            opt.classList.add('correct');
                        } else {
                            opt.classList.add('incorrect');
                        }
                    } else if (i === question.correctAnswer) {
                        opt.classList.add('correct');
                    }
                });
                
                showFeedback(questionIndex);
                updateVisualization(questionIndex, optionIndex);
            }
            
            function showFeedback(questionIndex) {
                const question = quizData[questionIndex];
                const userAnswer = state.userAnswers[questionIndex];
                
                if (userAnswer === null) return;
                
                const isCorrect = userAnswer === question.correctAnswer;
                
                const feedbackArea = document.getElementById('posttest-feedback-area');
                const feedbackText = document.getElementById('posttest-feedback-text');
                const feedbackExplanation = document.getElementById('posttest-feedback-explanation');
                
                feedbackArea.className = `feedback-area show ${isCorrect ? 'correct' : 'incorrect'}`;
                feedbackText.className = `feedback-text ${isCorrect ? 'correct' : 'incorrect'}`;
                
                if (isCorrect) {
                    feedbackText.innerHTML = '<i class="fas fa-check-circle"></i> Correct!';
                    feedbackExplanation.textContent = 'You selected the right answer.';
                } else {
                    feedbackText.innerHTML = '<i class="fas fa-times-circle"></i> Incorrect';
                    feedbackExplanation.textContent = `The correct answer is: ${String.fromCharCode(65 + question.correctAnswer)}. ${question.options[question.correctAnswer]}`;
                }
            }
            
            function updateVisualization(questionIndex, optionIndex) {
                const question = quizData[questionIndex];
                const isCorrect = optionIndex === question.correctAnswer;
                
                const visualSubtitle = document.getElementById('posttest-visual-subtitle');
                const visualContent = document.getElementById('posttest-visual-content');
                
                visualSubtitle.innerHTML = isCorrect 
                    ? '<span style="color: #10b981;"><i class="fas fa-check-circle"></i> Correct Answer Selected</span>'
                    : '<span style="color: #ef4444;"><i class="fas fa-times-circle"></i> Incorrect Answer Selected</span>';
                
                visualContent.innerHTML = question.visualization;
            }
            
            function updateProgress() {
                const progress = ((state.currentQuestion + 1) / quizData.length) * 100;
                document.getElementById('posttest-progress-fill').style.width = `${progress}%`;
                document.getElementById('posttest-correct-count').textContent = state.scores.correct;
            }
            
            function updateScore() {
                state.scores.correct = 0;
                state.scores.incorrect = 0;
                
                state.userAnswers.forEach((answer, index) => {
                    if (answer !== null) {
                        if (answer === quizData[index].correctAnswer) {
                            state.scores.correct++;
                        } else {
                            state.scores.incorrect++;
                        }
                    }
                });
                
                document.getElementById('posttest-correct-count').textContent = state.scores.correct;
            }
            
            function showResults() {
                state.submitted = true;
                updateScore();
                
                const score = state.scores.correct;
                const percentage = (score / quizData.length) * 100;
                
                document.getElementById('posttest-final-score').textContent = `${score}/${quizData.length}`;
                
                const reviewBtn = document.getElementById('posttest-review-btn');
                const proceedBtn = document.getElementById('posttest-proceed-btn');
                const completionMessage = document.getElementById('posttest-completion-message');
                
                if (score >= 4) {
                    reviewBtn.style.display = 'flex';
                    proceedBtn.style.display = 'flex';
                    completionMessage.textContent = "Great job! You have successfully completed the post-test.";
                } else {
                    reviewBtn.style.display = 'flex';
                    proceedBtn.style.display = 'none';
                    completionMessage.textContent = "Consider reviewing the lab material and retaking the test.";
                }
                
                const scoreMessage = document.getElementById('posttest-score-message');
                const feedbackFinal = document.getElementById('posttest-final-feedback');
                
                if (percentage >= 80) {
                    scoreMessage.textContent = "Excellent! You have mastered the DP concepts.";
                    feedbackFinal.textContent = "Outstanding performance!";
                    feedbackFinal.style.color = "#10b981";
                } else if (percentage >= 60) {
                    scoreMessage.textContent = "Good job! You have a solid understanding.";
                    feedbackFinal.textContent = "Well done!";
                    feedbackFinal.style.color = "#f59e0b";
                } else {
                    scoreMessage.textContent = "You may want to review the lab simulation again.";
                    feedbackFinal.textContent = "Keep practicing to improve.";
                    feedbackFinal.style.color = "#ef4444";
                }
                
                document.getElementById('posttest-results-overlay').classList.add('show');
            }
            
            function showPerformanceReview() {
                let reviewMessage = "Performance Review:\n\n";
                reviewMessage += `Total Questions: ${quizData.length}\n`;
                reviewMessage += `Correct Answers: ${state.scores.correct}\n`;
                reviewMessage += `Incorrect Answers: ${state.scores.incorrect}\n`;
                reviewMessage += `Score: ${state.scores.correct}/${quizData.length}\n\n`;
                
                reviewMessage += "Question Breakdown:\n";
                quizData.forEach((question, index) => {
                    const userAnswer = state.userAnswers[index];
                    const isCorrect = userAnswer === question.correctAnswer;
                    const status = isCorrect ? " Correct" : " Incorrect";
                    reviewMessage += `Q${index + 1}: ${status}\n`;
                });
                
                alert(reviewMessage);
            }
            
            function resetQuiz() {
                state.currentQuestion = 0;
                state.userAnswers.fill(null);
                state.scores = { correct: 0, incorrect: 0 };
                state.submitted = false;
                
                document.getElementById('posttest-results-overlay').classList.remove('show');
                loadQuestion(0);
                updateScore();
            }
            
            document.getElementById('posttest-total-questions').textContent = quizData.length;
            loadQuestion(state.currentQuestion);
            
            document.getElementById('posttest-prev-btn').addEventListener('click', () => {
                if (state.currentQuestion > 0) {
                    state.currentQuestion--;
                    loadQuestion(state.currentQuestion);
                }
            });
            
            document.getElementById('posttest-next-btn').addEventListener('click', () => {
                if (state.userAnswers[state.currentQuestion] === null) {
                    alert("Please select an answer before proceeding to the next question.");
                    return;
                }
                
                if (state.currentQuestion < quizData.length - 1) {
                    state.currentQuestion++;
                    loadQuestion(state.currentQuestion);
                } else {
                    showResults();
                }
            });
            
            document.getElementById('posttest-retake-btn').addEventListener('click', resetQuiz);
            document.getElementById('posttest-review-btn').addEventListener('click', showPerformanceReview);
            document.getElementById('posttest-proceed-btn').addEventListener('click', () => {
                document.querySelector('[data-mode="main"]').click();
            });
        })();
    </script>
</body>
</html>